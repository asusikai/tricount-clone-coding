{
  "master": {
    "tasks": [
      {
        "id": 1,
        "title": "프로젝트 초기 세팅 및 네비게이션 스캐폴딩",
        "description": "Flutter 3.24.3/Dart 3.5.2 기준 앱 부팅/환경 분리/Supabase 초기화/기본 페이지와 하단 탭(IndexedStack) 구조를 스캐폴딩합니다.",
        "details": "- pubspec.yaml 의존성(예시): supabase_flutter:^2, flutter_dotenv, intl, uni_links, share_plus, freezed, json_serializable, build_runner.\n- .env(.gitignore): SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_REDIRECT_URI.\n- iOS/Android URL Scheme: splitbills://invite.\n- main.dart 의사코드:\n  void main() async {\n    WidgetsFlutterBinding.ensureInitialized();\n    await dotenv.load(fileName: \".env\");\n    await Supabase.initialize(\n      url: dotenv.env['SUPABASE_URL']!,\n      anonKey: dotenv.env['SUPABASE_ANON_KEY']!,\n    );\n    runApp(const App());\n  }\n  class App extends StatelessWidget { ... MaterialApp(home: SplashPage()) }\n- 하단 탭: Groups/Requests/Profile, IndexedStack으로 상태 유지.\n- SplashPage→AuthPage/HomePage 라우팅 뼈대만 먼저 구성.",
        "testStrategy": "- flutter analyze 통과.\n- DEV/PROD 환경에서 Supabase.initialize 성공/실패 분기 테스트.\n- IndexedStack 탭 전환 시 스크롤/상태 유지 수동 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Android/iOS URL 스킴을 splitbills://invite로 통일하고 딥링크 라우팅 갱신",
            "description": "현재 tricount 스킴을 요구사항 splitbills://invite로 변경하고 모든 플랫폼/라우팅 설정을 정리합니다.",
            "dependencies": [],
            "details": "AndroidManifest.xml 인텐트 필터를 splitbills://invite 로 교체하고 기존 tricount 필터 제거; iOS Info.plist URL Types에 splitbills 추가 및 기존 항목 정리; 앱 내 딥링크 파서에서 /invite 경로와 code 파라미터 파싱으로 통일; 라우터 매핑(Splash→Auth/Home 포함)에서 초대 진입 흐름 검증 및 잘못된 스킴 가드 추가.",
            "status": "done",
            "testStrategy": "Android: adb VIEW 인텐트로 splitbills://invite?code=ABC 테스트, 콜드/웜 스타트 모두 확인. iOS: Xcode URL Schemes로 동일 시나리오 검증. 잘못된 스킴/누락 파라미터 방어 동작 확인.",
            "parentId": "undefined",
            "updatedAt": "2025-11-05T15:45:25.714Z"
          },
          {
            "id": 2,
            "title": ".env 기반 환경 주입 확정 및 빌드 스크립트/CI 정리",
            "description": "flutter_dotenv 중심으로 환경 주입을 표준화하고 dev/prod 분리를 적용합니다.",
            "dependencies": [],
            "details": "pubspec에 flutter_dotenv 추가 및 .env/.env.dev/.env.prod 구성(.gitignore 포함); lib/config/environment.dart 래퍼 작성해 SUPABASE_URL/ANON_KEY/REDIRECT_URI 안전 로드; main.dart에서 dotenv.load→Supabase.initialize 적용; 로컬/CI에서 .env 주입 방식 문서화 및 GitHub Actions에서 Secrets로 .env 생성 단계 반영.",
            "status": "done",
            "testStrategy": "로컬에서 .env 정상/누락/오염 값 각각 실행해 초기화 성공/실패 분기 확인. flutter run, flutter build 환경별로 값이 반영되는지 로그로 검증.",
            "parentId": "undefined",
            "updatedAt": "2025-11-05T15:45:46.589Z"
          },
          {
            "id": 3,
            "title": "IndexedStack 탭 상태 유지 점검 및 Nested Navigator 도입 결정",
            "description": "하단 탭 전환 시 상태 유지와 올바른 뒤로가기 동작을 보장하고 필요 시 탭별 Navigator를 도입합니다.",
            "dependencies": [
              1,
              2
            ],
            "details": "현 Home/탭 구현을 점검해 IndexedStack이 스크롤/폼 상태를 유지하는지 확인; 부족 시 각 탭에 GlobalKey<NavigatorState> 기반 Nested Navigator + Offstage 구조로 리팩터링; PageStorageKey 적용, 안드로이드 뒤로가기 시 탭 내부 스택 우선 팝 처리; 딥링크로 특정 탭 진입 후 복귀 흐름 정합성 확보.",
            "status": "done",
            "testStrategy": "수동 시나리오: 각 탭에서 상세로 진입→탭 전환→복귀 시 스크롤/폼 값 유지 확인. 딥링크로 Requests 탭 진입 후 뒤로가기 동작 검증. 위젯 테스트로 탭 전환 후 상태 보존 여부 체크.",
            "parentId": "undefined",
            "updatedAt": "2025-11-07T03:48:54.207Z"
          },
          {
            "id": 4,
            "title": "flutter analyze 통과 및 부팅 실패/예외 핸들링 보강",
            "description": "정적 분석 경고를 정리하고 부팅 단계의 예외를 사용자 친화적으로 처리합니다.",
            "dependencies": [
              1,
              2,
              3
            ],
            "details": "main()에 runZonedGuarded와 FlutterError.onError 설정으로 로깅 일원화; dotenv.load와 Supabase.initialize try/catch 래핑 및 ErrorPage/Retry 제공; 딥링크 파싱 실패 시 토스트/스낵바와 안전한 홈 복귀 처리; flutter analyze/format 실행해 경고 제거 및 CI에 분석 스텝 추가.",
            "status": "done",
            "testStrategy": "flutter analyze가 0 exit를 반환하는지 확인. .env 누락/잘못된 키/네트워크 실패 등을 모킹해 ErrorPage 노출과 재시도 동작을 수동 검증. 딥링크 파싱 예외 시 앱이 크래시하지 않는지 확인.",
            "parentId": "undefined",
            "updatedAt": "2025-11-07T03:58:34.690900Z"
          }
        ],
        "complexity": 4,
        "recommendedSubtasks": 4,
        "expansionPrompt": "레포의 현재 구현을 기준으로 다음을 정렬하세요: 1) URL 스킴 통일(요구사항 splitbills://invite vs 현재 tricount://group/join) 및 플랫폼 설정 갱신, 2) 환경 주입 전략 확정(.env/flutter_dotenv vs 현재 --dart-define)과 빌드 스크립트, 3) IndexedStack+탭 유지 구조 검증 및 Nested Navigator 필요 시 도입, 4) flutter analyze 및 기본 부팅 실패/예외 핸들링 보강.",
        "updatedAt": "2025-11-07T03:58:34.690900Z"
      },
      {
        "id": 2,
        "title": "OAuth 인증 플로우(Supabase Auth) 구현",
        "description": "Google/Apple/Kakao OAuth를 Supabase Auth로 연동하고 Splash→Auth/Home 라우팅을 완성합니다.",
        "details": "- SplashPage: 최상단에서 supabase.auth.currentSession 확인, onAuthStateChange 구독→세션 생성/만료 라우팅.\n- AuthPage: 튜토리얼 카드 + 버튼 3종.\n- 로그인 의사코드:\n  final resp = await supabase.auth.signInWithOAuth(\n    Provider.google,\n    redirectTo: dotenv.env['SUPABASE_REDIRECT_URI'],\n  );\n  if (resp.session != null) context.go('/home');\n- Apple은 iOS 전용 가드; Kakao는 Supabase Custom Provider 설정(redirect URI만) 사용.\n- 최초 로그인 시 users 테이블에 최소 정보 upsert(없으면 insert).",
        "testStrategy": "- 세션 null/존재 라우팅 단위/위젯 테스트.\n- OAuth 실패/취소/재시도 UX 확인(모킹).\n- users upsert 호출 파라미터/예외 로깅 검증.",
        "priority": "medium",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Splash/Auth/Home 라우팅 구성 및 onAuthStateChange 구독 연결",
            "description": "go_router 기반으로 Splash→Auth/Home 전환과 세션 변화 구독을 구현합니다.",
            "dependencies": [],
            "details": "`lib/app_router.dart`에 `GoRouter`를 정의하고, `SplashPage`에서 `supabase.auth.currentSession` 확인 후 초기 라우팅을 수행합니다. `supabase.auth.onAuthStateChange`를 앱 최상단(AuthScope 혹은 RouterRefreshListenable)에서 구독하여 `SignedIn/SignedOut/TokenRefreshed` 이벤트마다 `router.refresh()` 또는 `context.go('/home'|'/auth')`로 반영합니다. 관련 화면은 `lib/features/auth/presentation/splash_page.dart`, `auth_page.dart`, `home_page.dart`를 사용합니다.\n<info added on 2025-11-08T04:23:12.610Z>\n구현 완료 사항:\n- 최상단 구독 위치: `lib/main.dart:166`(MyApp) / 상태 클래스 `lib/main.dart:173`에 `StreamSubscription<AuthState>? _authStateSubscription` 추가, `initState`에서 `_listenToAuthStateChanges()` 호출, `dispose`에서 구독 취소.\n- 이벤트 매핑: `lib/main.dart:390` 인근\n  - `signedIn`: 현재 경로가 `RouteConstants.splash`가 아닐 때만 홈으로 이동(`RouteConstants.home`)\n  - `signedOut`/`userDeleted`: 현재 경로가 `splash`/`auth`가 아닐 때만 인증 페이지로 이동(`RouteConstants.auth`)\n  - `tokenRefreshed`: `appRouter.refresh()`로 현재 위치 유지\n  - `initialSession`: 무시(Splash에서 처리)\n  - 기타(`passwordRecovery/userUpdated/mfaChallengeVerified`): `appRouter.refresh()`\n- 현재 위치 확인으로 중복 네비 방지: `appRouter.routerDelegate.currentConfiguration.uri.path` 기준으로 가드 적용.\n- 관련 참조: 라우터 `lib/app_router.dart:12`, 경로 상수 `lib/core/constants/route_constants.dart`, 초기 라우팅은 `lib/features/splash/splash_page.dart`에서 `currentSession` 확인 후 수행. 이후 세션 변화는 `onAuthStateChange`에서만 처리.\n</info added on 2025-11-08T04:23:12.610Z>",
            "status": "done",
            "testStrategy": "- 세션 null/존재에 따른 리다이렉트 위젯 테스트\n- onAuthStateChange 모킹 후 라우터 전환 단위 테스트"
          },
          {
            "id": 2,
            "title": "AuthService/Repository 경유 Google·Apple·Kakao OAuth 버튼 및 플랫폼 가드 구현",
            "description": "OAuth 3종 로그인 버튼과 서비스 계층 호출을 분리해 구현합니다.",
            "dependencies": [
              1
            ],
            "details": "`lib/features/auth/application/auth_service.dart`에 `signInWithGoogle/Apple/Kakao`를 구현하고 내부에서 `supabase.auth.signInWithOAuth`를 호출합니다. `redirectTo`는 `dotenv.env['SUPABASE_REDIRECT_URI']` 사용. Apple은 `Platform.isIOS` 가드, Kakao는 Supabase Custom Provider(`Provider('kakao')`) 사용. `lib/features/auth/presentation/widgets/oauth_buttons.dart`에서 3종 버튼을 배치하고 서비스 호출 결과에 따라 성공 시 `context.go('/home')` 처리.\n<info added on 2025-11-08T04:24:30.469Z>\n구현 반영 사항:\n- OAuth 버튼 위젯 분리 완료: lib/features/auth/presentation/widgets/oauth_buttons.dart에 OAuthButtons(ConsumerWidget) 추가, 내부에 _GoogleButton/_AppleButton/_KakaoButton 구성. 버튼 탭 시 ref.read(authServiceProvider).signInWithProvider(provider) 호출로 서비스 계층 경유.\n- Apple iOS 가드: 동일 파일에서 Platform.isIOS 조건으로 Apple 버튼을 iOS에서만 노출(Android 비노출).\n- AuthPage 리팩토링: lib/features/auth/auth_page.dart에서 OAuth 버튼 로직을 OAuthButtons 위젯으로 이관, _signInWithProvider 제거. 페이지 진입 시 저장된 에러 스낵바만 처리.\n- Kakao Provider: lib/features/auth/presentation/widgets/oauth_buttons.dart에서 OAuthProvider.kakao 사용. Custom Provider('kakao') 불필요.\n- 리다이렉트 URI: lib/data/repositories/auth_repository_impl.dart에서 Environment.buildSupabaseRedirectUri(provider.name)로 provider별 redirectTo 구성(Supabase SDK v2 패턴 준수).\n- 로그인 성공 후 라우팅: 별도의 context.go 호출 제거. main.dart의 client.auth.onAuthStateChange 리스너에서 AuthChangeEvent.signedIn 시 RouteConstants.home으로 이동 처리.\n</info added on 2025-11-08T04:24:30.469Z>",
            "status": "done",
            "testStrategy": "- 각 프로바이더 호출 성공/실패/취소를 모킹하여 버튼 탭 흐름 테스트\n- iOS/Android에서 Apple 가드 동작 검증(가짜 플랫폼 세팅)"
          },
          {
            "id": 3,
            "title": ".env/URL 스킴/리다이렉트 URI 점검과 오류·취소 스낵바 표준화",
            "description": "환경변수와 딥링크 스킴 정합성을 확인하고 스낵바 메시지를 통일합니다.",
            "dependencies": [
              1,
              2
            ],
            "details": "`.env`에 `SUPABASE_URL/ANON_KEY/REDIRECT_URI` 존재 여부를 부팅 시 검증하는 유틸을 `lib/core/config/env_validator.dart`로 추가합니다. Android `AndroidManifest.xml` 인텐트 필터와 iOS URL Types가 `splitbills://auth-callback`(예) 등과 일치하는지 점검 가이드 반영. OAuth 오류/취소 시 공통 스낵바 헬퍼 `lib/core/ui/app_snackbar.dart`로 메시지를 일원화합니다(예: 네트워크 오류/취소/미지원 플랫폼).\n<info added on 2025-11-08T04:29:34.579Z>\n구현 결과 반영:\n- 환경 변수/URL 스킴 검증 유틸 추가: lib/core/config/env_validator.dart\n  - validateEnvironment(), validateUrlSchemes(), validateAll() 및 ValidationResult/SchemeValidationResult/FullValidationResult 구현\n  - URL 스킴(scheme/host) 파싱, 예상 스킴 검증(splitbills + legacy tricount), Android/iOS 가이드 문자열 생성, logResults() 제공\n- 스낵바 표준화: lib/core/ui/app_snackbar.dart\n  - showNetworkError(), showCancelled(), showUnsupportedPlatform(), showOAuthError(), showOAuthErrorWithRetry(), showSessionExpired(), showConfigError(), _extractErrorMessage() 구현\n  - 공통 헬퍼 lib/core/utils/snackbar_helper.dart 사용\n- 부팅 시 통합 검증: lib/main.dart\n  - _bootstrap()에서 Environment.load() → Environment.ensureSupabase() → EnvValidator.validateAll() 호출 및 logResults()\n  - 실패 시 ValidationResult.issues와 SchemeValidationResult.androidGuide/iosGuide를 합쳐 StateError로 전달, lib/bootstrap/bootstrap_error_page.dart로 상세 가이드/재시도 버튼 노출\n  - Supabase.initialize 시 AuthFlowType.pkce 적용\n- OAuth 버튼 오류 처리: lib/features/auth/presentation/widgets/oauth_buttons.dart\n  - Google/Apple/Kakao 버튼 공통 핸들러에서 AppSnackbar로 취소/네트워크/일반 오류 분기\n  - 일반 오류 시 showOAuthErrorWithRetry()로 재시도 액션 제공\n- URL 스킴 구성 확인:\n  - Android: android/app/src/main/AndroidManifest.xml\n    - splitbills://auth/* 및 legacy tricount://auth/* 인텐트 필터 병행 구성\n    - splitbills://invite 인텐트 필터 구성\n    - io.supabase.tricount://login-callback 커스텀 스킴 인텐트 필터 포함\n  - iOS: ios/Runner/Info.plist\n    - CFBundleURLTypes에 io.supabase.tricount, splitbills, tricount 스킴 등록\n- 환경 파일 경로 명시 및 병합 규칙:\n  - lib/config/environment.dart 기준 assets/env/.env(베이스) + 환경별 오버레이(.env.dev/.env.prod 등) 병합 로드\n  - 필수 키(SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_REDIRECT_URI) 누락 시 StateError 발생\n- 수동 검증 가이드:\n  - SUPABASE_REDIRECT_URI를 assets/env/.env.*에 설정 후 앱 부팅 시 BootstrapErrorPage 미노출인지 확인\n  - Android에서 splitbills://auth/google(또는 apple/kakao) 및 legacy tricount://auth/* 링크로 딥링크 열어 콜백 처리 확인\n  - OAuth 취소/네트워크 차단/일반 오류 상황에서 각 표준 스낵바 메시지 및 재시도 버튼 동작 확인\n</info added on 2025-11-08T04:29:34.579Z>",
            "status": "done",
            "testStrategy": "- 잘못된/누락된 ENV일 때 경고 노출 단위 테스트\n- 의도적 취소 발생 시 표준 스낵바 문구/스타일 확인"
          },
          {
            "id": 4,
            "title": "최초 로그인 시 users 테이블 upsert 유틸 추가 및 연동",
            "description": "Supabase Auth 사용자 정보로 users 테이블에 최소 정보 upsert를 수행합니다.",
            "dependencies": [
              2
            ],
            "details": "`lib/data/repositories/user_repository.dart`에 `upsertFromAuthUser(AuthResponse/Session)` 메서드를 추가해 `supabase.from('users').upsert({...}, onConflict:'id')` 호출을 구현합니다. 필드: `id/email/name/nickname/provider/avatar_url/created_at/updated_at`. 로그인 성공 직후 AuthService에서 1회 호출하고 실패 시 재시도 가능하도록 결과를 반환합니다.\n<info added on 2025-11-08T04:33:44.539Z>\n구현 위치 및 시그니처 업데이트: users upsert 유틸은 lib/data/repositories/auth_repository_impl.dart의 upsertFromAuthSession(Session)으로 제공되며, onConflict: 'id' 옵션으로 supabase.from('users').upsert(payload, onConflict: 'id')를 호출합니다. 필드는 id, email, name, nickname, provider, avatar_url, updated_at만 포함하고 created_at은 DB 기본값에 위임합니다. 재시도 로직은 최대 3회, 지수 백오프 500ms/1000ms/1500ms로 수행하며 성공/실패를 bool로 반환합니다. 보조 추출기 추가: _extractNickname(userMetadata에서 nickname/ preferred_username/ username), _extractAvatarUrl(userMetadata의 avatar_url/picture 우선, 없으면 user.userMetadata), _extractName는 기존 키(full_name, name, display_name, preferred_username)만 사용하며 nickname 키는 제외합니다. syncUserProfile()은 현재 세션을 읽어 내부에서 upsertFromAuthSession을 호출하도록 개선했으며 AuthService를 통한 기존 호출 경로와 호환됩니다. AuthCallbackHandler 개선: lib/core/auth/auth_callback_handler.dart의 _processSuccessfulLogin에서 repository.upsertFromAuthSession(session) 결과를 확인하고 실패 시 AuthService.setAuthError로 사용자 친화적 메시지를 설정하며, 로그인은 완료하되 프로필 동기화 실패는 로그로 남깁니다. 참고: nickname 필드는 현재 supabase.sql의 users 테이블에 없을 수 있으며, 이 경우 upsert 시 해당 필드는 무시됩니다.\n</info added on 2025-11-08T04:33:44.539Z>",
            "status": "done",
            "testStrategy": "- 새 사용자/기존 사용자 각각 upsert idempotency 검증\n- 누락 필드/네트워크 오류 시 예외 로깅 및 호출부 재시도 분기 테스트"
          },
          {
            "id": 5,
            "title": "세션 만료·로그아웃 경계 케이스 처리와 재시도 플로우",
            "description": "토큰 만료, 명시적 로그아웃, 사용자 삭제 등 이벤트를 처리하고 재시도를 제공합니다.",
            "dependencies": [
              1,
              2,
              3,
              4
            ],
            "details": "`onAuthStateChange`에서 `TokenRefreshed/SignedOut/UserDeleted` 분기를 처리해 앱 상태 초기화와 라우팅을 보장합니다. `AuthService.signOut()` 구현으로 명시적 로그아웃을 제공하고, OAuth 실패/취소 시 재시도 버튼(스낵바 액션 또는 대체 CTA)을 노출합니다. 일정 시간 후 자동 재시도(백오프) 로직은 UI 안내만 하고 수동 재시도 중심으로 구성합니다.\n<info added on 2025-11-08T04:40:41.680Z>\n구현 완료\n인증 상태 관리 유틸리티를 lib/core/auth/auth_state_manager.dart에 추가했다. clearAppState(), clearStateOnSessionExpiry(), clearStateOnUserDeleted()를 제공하며 AuthService 에러, 로그인 시도 시간, OAuth 플로우 상태 등 공통 인증 상태를 초기화한다. ref를 전달하면 Riverpod Provider 상태 초기화도 지원한다.\nonAuthStateChange 이벤트 처리를 lib/main.dart에서 강화했다. _handleSignOut()으로 로그아웃 시 상태를 초기화하고 세션 만료 알림을 표시하며, _handleUserDeleted()로 사용자 삭제 시 상태를 초기화한다. _showSessionExpiredMessage()로 세션 만료 알림을 제공하고 tokenRefreshed 이벤트에 로그를 추가했다.\nProfilePage 로그아웃 흐름을 lib/features/profile/profile_page.dart에서 개선했다. 로그아웃 전에 AuthStateManager.clearAppState(ref)를 호출하고 에러 처리 및 사용자 피드백을 추가했으며, 성공 시 SplashPage로 이동한다(onAuthStateChange가 Auth로 리다이렉트).\nOAuth 재시도 플로우는 oauth_buttons.dart에서 AppSnackbar.showOAuthErrorWithRetry()를 사용해 스낵바에 재시도 버튼을 제공하는 방식으로 동작한다.\n참고: Provider별 상태 초기화는 각 Consumer 위젯에서 ref.invalidate()로 처리하며, AuthStateManager는 공통 인증 상태만 초기화한다.\n</info added on 2025-11-08T04:40:41.680Z>",
            "status": "done",
            "testStrategy": "- 토큰 만료 이벤트 모킹→Auth로 전환 확인\n- 로그아웃 호출 후 캐시/상태 초기화 여부 검증\n- 재시도 버튼 탭 시 정상 플로우 복귀 테스트"
          },
          {
            "id": 6,
            "title": "로그/분기 AppError 규격화 및 매핑 레이어 추가",
            "description": "에러 모델을 단일 규격으로 정의하고 Supabase/플랫폼 예외를 매핑합니다.",
            "dependencies": [
              1,
              2,
              3
            ],
            "details": "`lib/core/error/app_error.dart`에 `sealed class AppError`(Network/Auth/Cancelled/Config/Unknown 등) 정의, `lib/core/error/error_mapper.dart`에 SupabaseAuthException/PlatformException→AppError 매핑을 구현합니다. `AuthService`, `EnvValidator`, `UserRepository`에서 매핑 결과만 외부로 노출하고, 로깅은 `logger` 또는 `debugPrint`로 통일합니다. UI 레이어는 AppError 기준으로 스낵바/다이얼로그를 표시합니다.\n<info added on 2025-11-08T04:43:59.798Z>\n구현 완료\n\n1. lib/core/error/app_error.dart에 AppError sealed class 추가\n   - 타입: NetworkError, AuthError, CancelledError, ConfigError, PermissionError, NotFoundError, ValidationError, UnknownError\n   - 공통 필드: message, cause, stackTrace\n\n2. lib/core/error/error_mapper.dart에 ErrorMapper 구현\n   - toAppError: 예외→AppError 변환\n   - mapAndLog: 변환 후 debugPrint 로깅\n   - 매핑 대상: SupabaseAuthException, PlatformException, PostgrestException, StorageException\n   - 일반 Exception은 메시지 패턴 분석으로 적절한 AppError 매핑\n\n3. lib/core/ui/app_snackbar.dart 업데이트\n   - showError(AppError): 타입별 스낵바 표출\n   - showErrorWithRetry(AppError, onRetry): 재시도 액션 포함\n   - 기존 메서드는 deprecated 유지(하위 호환)\n\n4. lib/data/repositories/auth_repository_impl.dart 반영\n   - OAuth 로그인 실패/프로필 동기화 실패 시 ErrorMapper.mapAndLog 로 로깅 및 변환\n   - 기존 ErrorHandler 공존으로 하위 호환 보장\n\n5. lib/features/auth/presentation/widgets/oauth_buttons.dart 반영\n   - 로그인 실패를 ErrorMapper.mapAndLog로 AppError 변환\n   - AppError 타입에 따라 AppSnackbar.showError / showErrorWithRetry 호출\n   - sealed class 패턴 매칭으로 타입 안전 처리\n\n6. EnvValidator 및 main.dart 반영\n   - 환경 변수 검증 실패를 ConfigError로 매핑하여 mapAndLog 로깅\n   - main.dart _bootstrap에서 검증 실패 로깅 추가\n\n정책\n- 에러 로깅은 debugPrint로 통일\n- UI 레이어는 AppError 기준의 스낵바 표출로 일원화\n- 기존 API는 deprecated 주석으로 하위 호환 유지\n</info added on 2025-11-08T04:43:59.798Z>",
            "status": "done",
            "testStrategy": "- 다양한 예외 입력에 대한 매핑 단위 테스트\n- AppError별 메시지/액션(UI) 렌더링 확인(모킹)"
          }
        ],
        "complexity": 4,
        "recommendedSubtasks": 4,
        "expansionPrompt": "1) 기존 PKCE 콜백 처리(main.dart _handleAuthCallback)와 라우팅 재확인, 2) Kakao/Apple/Google 각각 redirect URI/스킴 일치 점검 및 오류 UX 스낵바 표준화, 3) users upsert 후 오류 로깅/리커버리 정리, 4) 세션 만료/로그아웃 후 재로그인 경계 케이스 보강(재시도 딜레이/flow state)."
      },
      {
        "id": 3,
        "title": "데이터 모델 및 리포지토리 레이어 구축",
        "description": "PRD 스키마(users, groups, members, expenses, settlements, exchange_rates)를 기준으로 DTO와 Supabase CRUD 리포지토리를 작성합니다.",
        "details": "- freezed/json_serializable로 모델 정의(테이블 필드명 준수: groups.base_currency 포함).\n- 예시 모델:\n  @freezed class Group with _$Group { factory Group({required String id, required String name, required String inviteCode, required String baseCurrency}) = _Group; factory Group.fromJson(Map<String,dynamic> json)=>_$GroupFromJson(json); }\n- 리포지토리 예시:\n  class GroupRepository { final SupabaseClient client; Future<List<Group>> byUser(String uid) async => (await client.from('groups').select().then(...)).map(Group.fromJson).toList(); Future<Group> create(String name,String cur) async => client.from('groups').insert({'name':name,'base_currency':cur}).select().single().then(Group.fromJson); }\n- 에러를 AppException으로 래핑해 호출부 단순화.",
        "testStrategy": "- JSON 직렬화/역직렬화 라운드트립 테스트.\n- CRUD 메서드 시그니처/에러 분기 단위 테스트(HTTP/Supa 모킹).",
        "priority": "medium",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "freezed/json_serializable 의존성 추가와 build_runner 파이프라인 구성",
            "description": "모델 코드 생성을 위해 freezed, json_serializable, build_runner를 추가하고 기본 설정을 정리합니다.",
            "dependencies": [],
            "details": "- `pubspec.yaml`에 `freezed`, `json_annotation`, `build_runner`, `freezed_annotation`, `json_serializable` 추가\n- `analysis_options.yaml`에 `implicit-casts: false` 등 엄격 모드 권장 설정\n- 필요 시 `build.yaml`에서 `json_serializable` 옵션(필드 이름 유지, any_map 등) 정리\n- 스크립트: `flutter pub run build_runner build --delete-conflicting-outputs`\n- CI를 고려해 로컬/CI 모두 동일 스크립트를 사용하도록 명명 규칙 통일",
            "status": "done",
            "testStrategy": "의존성 설치 확인 및 코드 생성 명령이 정상 종료되는지 수동 점검(로그 확인)."
          },
          {
            "id": 2,
            "title": "DTO 모델 정의(users, groups, members, expenses, settlements, exchange_rates)",
            "description": "PRD 스키마에 맞춘 DTO를 `@freezed`와 `json_serializable`로 생성합니다.",
            "dependencies": [
              1
            ],
            "details": "- 경로: `lib/domain/models/`\n- 각 테이블 DTO 정의: users, groups(base_currency 포함), members, expenses(participants 필드는 후속 컨버터 연결 예정), settlements, exchange_rates\n- 컬럼 스네이크→카멜 매핑: 예) `invite_code`→`inviteCode`, `base_currency`→`baseCurrency`, `created_at`→`createdAt`\n- `@JsonKey(name: '...')`로 DB 컬럼명 보존, `fromJson/toJson` 생성\n- `id` 타입과 `timestamp` 필드 타입(예: `DateTime`) 명확화",
            "status": "done",
            "testStrategy": "각 DTO에 대해 샘플 JSON을 만들어 fromJson→toJson 라운드트립 무결성 확인 계획 문서화."
          },
          {
            "id": 3,
            "title": "expenses.participants(jsonb) 모델 및 직렬화/컨버터 유틸 구현",
            "description": "participants(jsonb) 필드 전용 타입과 JsonConverter를 정의해 안전한 직렬화/역직렬화를 제공합니다.",
            "dependencies": [
              2
            ],
            "details": "- 경로: `lib/domain/models/participants.dart`, `lib/domain/models/converters/participants_converter.dart`\n- 예시 스키마: `{ user_id: string, ratio: double, amount: double? }` 리스트\n- `@JsonSerializable` 또는 `@freezed`로 `ParticipantShare` 정의\n- `JsonConverter<List<ParticipantShare>, dynamic>` 구현해 `expenses` DTO 필드에 적용\n- 유효성(비율 합=1.0±ε, userId 중복 방지) 검사 헬퍼 포함",
            "status": "done",
            "testStrategy": "유효/무효 샘플 JSON에 대한 파싱 실패/성공 케이스 설계 및 라운드트립 검증 계획 수립."
          },
          {
            "id": 4,
            "title": "공통 AppException과 Result 타입 도입 및 에러 매핑",
            "description": "Supabase/네트워크/직렬화 오류를 AppException으로 래핑하고, 호출부에 Result<T> 패턴을 제공합니다.",
            "dependencies": [
              1
            ],
            "details": "- 경로: `lib/core/errors/app_exception.dart`, `lib/core/errors/result.dart`\n- 예외 카테고리: validation, notFound, unauthorized, forbidden, conflict, network, unknown 등\n- Supabase/Postgrest 에러를 AppException으로 변환하는 mapper 구현\n- `Result<T>`: `success(value)` / `failure(AppException)` 팩토리 제공",
            "status": "done",
            "testStrategy": "에러 매핑 표를 문서화하고, 대표 시나리오(404, RLS, unique 위반)별 변환 결과를 단위 테스트 계획으로 정의."
          },
          {
            "id": 5,
            "title": "Supabase CRUD 리포지토리 구현 및 스네이크→카멜 매핑 규약 적용",
            "description": "각 테이블별 CRUD 메서드를 작성하고 공통 에러/결과 타입으로 감싸 일관된 API를 제공합니다.",
            "dependencies": [
              1,
              2,
              3,
              4
            ],
            "details": "- 경로: `lib/data/repositories/`\n- 리포지토리: UsersRepository, GroupsRepository, MembersRepository, ExpensesRepository, SettlementsRepository, ExchangeRatesRepository\n- 컬럼 매핑 규약 적용(`@JsonKey`) + repo에서 select/insert/update/delete 표준화\n- 예: `GroupsRepository.byUser(String uid)`, `create({name, baseCurrency})` 등\n- 모든 메서드는 `Result<T>`로 반환, 예외는 AppException으로 변환\n- 페이징/정렬 파라미터 최소 지원, `participants` 필드 컨버터 연결",
            "status": "done",
            "testStrategy": "각 리포지토리의 CRUD 시그니처와 예외 분기를 모킹으로 단위 테스트하는 계획 수립(실행은 생략)."
          },
          {
            "id": 6,
            "title": "기존 서비스 호출부를 신규 리포지토리로 단계적 치환",
            "description": "페이지/서비스 레이어에서 직접 호출하던 로직을 신규 리포지토리로 교체하고 컴파일 오류를 제거합니다.",
            "dependencies": [
              5
            ],
            "details": "- 대상 예: Group 목록/생성, Expense 생성/조회, Settlement 조회/생성\n- 호출부를 `Result` 기반으로 리팩터링하고 실패 시 UX 표준 에러 핸들링 경로 연결\n- 변경 범위와 임시 어댑터 정의, TODO 태그로 추후 정리 포인트 표시\n- 성능 영향 최소화를 위해 라우트별 점진 적용",
            "status": "done",
            "testStrategy": "화면별(그룹/지출/정산) 주요 흐름에서 성공/실패 경로를 수동 시나리오로 점검하는 체크리스트 작성."
          },
          {
            "id": 7,
            "title": "코드 생성/정리 스크립트와 .gitignore 최종 정비, 문서/PR 작성",
            "description": "코드 생성 스크립트와 ignore 규칙을 마무리하고 AGENTS.md/README 갱신 및 브랜치/PR을 준비합니다.",
            "dependencies": [
              1,
              5,
              6
            ],
            "details": "- 스크립트: `flutter pub run build_runner build|watch --delete-conflicting-outputs` 통일\n- `.gitignore`에 `*.g.dart`, `*.freezed.dart`, `.dart_tool/` 등 최종 반영\n- `AGENTS.md`/`README`에 모델/리포지토리 사용법과 코드생성 절차 문서화\n- 브랜치 전략에 따라 `feature/model-repo-layer` 생성 후 PR 템플릿(한글)로 제출",
            "status": "done",
            "testStrategy": "문서의 재현 절차에 따라 신규 환경에서 코드 생성이 문제없이 동작하는지 체크리스트 기반으로 확인 계획 수립."
          }
        ],
        "complexity": 7,
        "recommendedSubtasks": 7,
        "expansionPrompt": "1) freezed/json_serializable 및 build_runner 파이프라인 추가, 2) DTO 정의(users, groups(base_currency), members, expenses(participants[]), settlements, exchange_rates), 3) Map 기반 서비스(Group/Request)→타입 안전 리포지토리로 마이그레이션, 4) 공통 AppException/Result 도입, 5) 직렬화 라운드트립/널세이프티 테스트, 6) 생성 코드 스크립트/ignore 정리, 7) 단계적 치환(컴파일 안전 보장)."
      },
      {
        "id": 4,
        "title": "그룹 생성/목록/상세(UI) 구현",
        "description": "그룹 생성(name, base_currency)과 목록/상세(GroupPage) UI, 기본 상태관리 및 새로고침을 구현합니다.",
        "details": "- 그룹 생성 다이얼로그→GroupRepository.create 호출→성공 시 리스트 갱신.\n- GroupPage: 상단 잔액/지출 섹션, 날짜/사용자별 필터 탭(간단 리스트 구현).\n- 초대 코드(invite_code)는 DB 트리거/함수 생성 가정: insert 결과에 포함.\n- 통화 포맷: intl NumberFormat.currency(locale/currency 코드 활용).",
        "testStrategy": "- 생성 폼 검증(이름/통화 필수) 위젯 테스트.\n- 생성 후 목록 반영/스낵바 확인.\n- 빈 상태/에러 상태 화면 처리 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "GroupList 화면 스켈레톤 및 GroupRepository.byUser 연결과 새로고침 구현",
            "description": "Groups 탭에 그룹 목록 스켈레톤을 만들고 byUser 데이터와 연결합니다. 풀투리프레시/재시도와 기본 캐시 무효화를 포함합니다.",
            "dependencies": [],
            "details": "- 목록 페이지/위젯 스켈레톤 구성(타이틀, 리스트, 빈/에러 영역 슬롯)\n- ViewModel(Async 상태)로 GroupRepository.byUser(uid) 호출, 최초 로드/당겨서 새로고침/수동 재시도 지원\n- 기본 캐시 정책: 포그라운드 재진입 시 시간기반 무효화(예: 60초) 또는 명시적 invalidate 훅 제공\n- 항목 탭 시 GroupPage로 라우팅, invite_code 등 핵심 필드 전달",
            "status": "done",
            "testStrategy": "리포지토리 모킹으로 성공/빈/에러 시나리오 위젯 테스트, 풀투리프레시 트리거 시 재호출 확인"
          },
          {
            "id": 2,
            "title": "그룹 생성 다이얼로그(이름/통화)와 create 호출, 낙관적 갱신 및 스낵바",
            "description": "그룹 생성 폼(이름, 기본 통화)과 유효성 검사를 제공하고 생성 시 리스트 낙관적 반영/실패 롤백 및 피드백을 처리합니다.",
            "dependencies": [
              1
            ],
            "details": "- 모달 다이얼로그에 TextField(name), 통화 선택(간단 드롭다운) 및 확인/취소 버튼\n- GroupRepository.create(name, baseCurrency) 호출 전 로컬 낙관적 항목 추가(id 임시), 성공 시 서버 값으로 교체, 실패 시 롤백\n- 성공/실패 스낵바, 중복 제출 방지 로딩 상태, 닫힘 후 포커스 해제\n- 생성 후 목록 스크롤 상단 유지 및 새로고침 invalidate 호출",
            "status": "done",
            "testStrategy": "폼 검증(필수값) 위젯 테스트, create 성공 시 목록 반영/스낵바 노출, 실패 시 롤백/에러 스낵바 확인"
          },
          {
            "id": 3,
            "title": "GroupPage 상단 잔액/지출 섹션과 날짜·사용자 필터 탭 및 간단 리스트",
            "description": "그룹 상세에서 상단 요약(잔액/총지출)과 날짜/사용자 필터 탭을 제공하고 필터링된 지출 간단 리스트를 구현합니다.",
            "dependencies": [
              1,
              4,
              5
            ],
            "details": "- 헤더: 그룹 기준통화 표시, 총지출/내지분 요약 카드, 새로고침 버튼\n- 탭: 날짜별, 사용자별 전환(각각 간단 섹션 리스트), 기본 정렬 및 필터 상태 유지\n- 지출 아이템: 설명, 금액(통화 포맷 적용), 날짜, 부담자 표시\n- 상태 표시: 로딩/빈/에러 시 공통 컴포넌트 사용, 라우팅 파라미터로 groupId 수신",
            "status": "done",
            "testStrategy": "더미 데이터 주입으로 합계/필터 결과 검증, 탭 전환 시 상태 유지, 통화 포맷 적용 여부 확인"
          },
          {
            "id": 4,
            "title": "공통 빈/에러/로딩 UI 컴포넌트 제작 및 적용",
            "description": "로딩 스피너, 빈 상태, 에러+재시도 버튼을 공통 위젯으로 만들고 목록/상세에 적용합니다.",
            "dependencies": [],
            "details": "- Loading, Empty(message+action?), Error(message+retry) 기본 위젯 정의\n- 다크모드/접근성 대비 색상과 최소 터치 타겟 고려\n- 콜백 주입형 API로 재사용성 확보, 스낵바/토스트와 함께 사용 가능하도록 설계\n- GroupList/GroupPage에서 기존 임시 표시를 공통 컴포넌트로 교체",
            "status": "done",
            "testStrategy": "각 위젯 렌더 스냅샷, retry 콜백 호출 검증, 긴 텍스트/다국어 레이아웃 깨짐 수동 점검"
          },
          {
            "id": 5,
            "title": "intl 기반 통화 포맷 유틸 도입 및 리스트/상세 적용",
            "description": "NumberFormat.currency를 래핑한 통화 포맷 유틸을 추가하고 그룹 목록/상세 요약과 아이템 금액 표시에 적용합니다.",
            "dependencies": [],
            "details": "- MoneyFormatter 유틸: locale, currencyCode 입력받아 안전한 포맷 반환(소수점 처리/마이너스/0원 케이스)\n- 기본 locale 결정 전략(시스템/그룹 기준통화 우선 적용)과 폴백 정의\n- GroupList 항목 금액, GroupPage 헤더 합계/아이템에 적용\n- 확장 가능하도록 소수 자릿수/기호 커스터마이즈 옵션 제공",
            "status": "done",
            "testStrategy": "KRW/USD/EUR 포맷 단위 테스트(부호/자릿수/라운딩), null/빈 통화코드 폴백 확인, UI 스냅샷으로 적용 여부 점검"
          }
        ],
        "complexity": 5,
        "recommendedSubtasks": 5,
        "expansionPrompt": "1) GroupPage 스켈레톤(지출/잔액 섹션, 필터 탭) 신규, 2) GroupCreatePage 완료 후 목록 갱신/스낵바 흐름 정제, 3) 상태관리(현재 로컬 setState→Provider/캐시) 정리, 4) 빈/에러/로딩 상태 UX 보강, 5) 통화 표기(intl) 유틸 도입 및 적용."
      },
      {
        "id": 5,
        "title": "딥링크 초대 처리 및 자동 가입",
        "description": "초대 링크(splitbills://invite?code=XXXX) 공유/열기 처리와 자동 가입(RPC)을 구현합니다.",
        "details": "- 링크 생성: 초대 공유 시 `splitbills://invite?code=$inviteCode`를 share_plus로 공유.\n- 수신: uni_links로 getInitialLink()/linkStream 처리, Uri.parse로 code 추출.\n- 가입 의사코드:\n  final code = uri.queryParameters['code'];\n  await supabase.rpc('rpc_create_invite', params: {'code': code});\n  // 또는 members insert: from('members').insert({'user_id': uid,'group_id': gid})\n- cold/warm start 모두 처리, 실패 시 안내/재시도 제공.",
        "testStrategy": "- 링크 파싱 유닛 테스트(유효/무효/누락 코드).\n- 앱 실행 중/비실행 상태 모두 링크 처리 수동 검증.\n- RPC 실패/중복 가입 예외 처리 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "딥링크 포맷 통일 및 초대 링크 생성/공유 훅 구현",
            "description": "초대 링크 스킴을 splitbills://invite?code= 로 통일하고, 링크 생성 함수와 공유(share_plus) 액션을 추가합니다. 기존 tricount 스킴은 하위 호환 처리합니다.",
            "dependencies": [],
            "details": "- Android IntentFilter, iOS URL Types에 스킴 splitbills와 호스트 invite를 등록합니다. - 초대 코드로 splitbills://invite?code={code} URL을 생성하는 유틸/서비스 메서드를 추가 또는 기존 getInviteLink를 수정합니다. - 그룹 화면에 ‘초대 공유’ 버튼을 배치하고 share_plus로 링크를 공유합니다. - 기존 tricount://group/join?code= 링크는 생성 중지하되, 수신 시에도 처리될 수 있도록 파서에서 임시 대응합니다.",
            "status": "done",
            "testStrategy": "- 링크 문자열 생성 단위 테스트: 유효 코드 → 기대 URL 일치 확인. - Android/iOS에서 실제 공유 호출 시 예외 없이 동작 수동 확인. - 기존 tricount 스킴 입력 시 생성되지 않음을 확인.",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "앱 초기/런타임 딥링크 수신·파싱 및 자동 가입 RPC 처리",
            "description": "uni_links 기반으로 getInitialLink와 linkStream을 처리하고, code 파싱 후 Supabase RPC(rpc_create_invite)로 자동 가입을 수행합니다.",
            "dependencies": [
              1
            ],
            "details": "- DeepLink 처리 모듈/서비스를 만들고 앱 시작(getInitialLink)과 실행 중(linkStream) 모두 구독합니다. - Uri.parse로 code를 추출하고 splitbills 스킴과 /invite 경로를 우선 처리, 기존 tricount 포맷은 임시 변환합니다. - 인증 미완료 상태면 큐에 보관 후 로그인 완료 이벤트 시 재처리합니다. - 중복 호출 방지를 위해 동일 링크 재실행 락/디바운스 적용 및 예외 로깅을 추가합니다. - 성공 시 RPC 응답의 group 식별자를 받아 라우팅용 이벤트를 발행합니다.",
            "status": "done",
            "testStrategy": "- 링크 파서 유닛 테스트: 정상/누락/잘못된 스킴/기존 tricount 포맷. - 콜드 스타트(getInitialLink)와 웜 스타트(linkStream) 시나리오 모킹 테스트. - RPC 성공/실패/중복 가입 에러 모킹으로 분기 검증.",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "가입 실패/중복 UX 정리 및 성공 리다이렉트·재시도·로깅 구현",
            "description": "자동 가입 실패/중복 케이스에 대한 사용자 메시지, 재시도 버튼, 성공 시 그룹 화면 리다이렉트 정책을 정의하고 구현합니다.",
            "dependencies": [
              1,
              2
            ],
            "details": "- RPC 에러 코드를 사용자 친화 메시지(만료 코드, 권한 없음, 네트워크 오류, 이미 가입 등)로 매핑해 SnackBar/Dialog로 노출합니다. - 재시도 액션을 제공하고, 네비게이션은 성공 시 GroupPage로 이동하면서 백스택 정리 정책을 문서화/적용합니다. - 처리 결과를 로깅(디버그/선택적 Crashlytics)하고, 텔레메트리 이벤트 키를 표준화합니다. - 동일 링크 재처리 방지를 위한 완료 상태 표시 및 UX 피드백(로딩 인디케이터/완료 토스트)을 제공합니다.",
            "status": "done",
            "testStrategy": "- 위젯 테스트: 실패 시 다이얼로그/스낵바 노출과 재시도 액션 동작. - 중복 가입 에러 모킹 시 안내 메시지와 리다이렉트 미발생 확인. - 성공 시 GroupPage로 이동 및 백스택 정책 수동 검증.",
            "parentId": "undefined"
          }
        ],
        "complexity": 3,
        "recommendedSubtasks": 3,
        "expansionPrompt": "1) 초대 링크 포맷 통일(요구 splitbills://invite?code= vs 현재 tricount://group/join?code=) 및 공유 훅 추가(share_plus), 2) app_links 기반 초기/런타임 링크 파싱 재검증, 3) 가입 실패/중복 UX와 리다이렉트 정책 정리.",
        "updatedAt": "2025-11-07T04:43:06.961Z"
      },
      {
        "id": 6,
        "title": "지출 등록/수정(분담비 포함) 구현",
        "description": "ExpensePage에서 날짜, 금액, 통화, 부담자, 참가자, 분담 비율 입력 및 저장(update 포함)을 구현합니다.",
        "details": "- Equal split 토글→참가자 수로 균등 분배, 커스텀 모드에서 비율 합=1.0 검증.\n- 환율 표시는 그룹 base_currency 기준으로 환산 표시(표시는 rates 사용). DB 저장은 원화/선택 통화와 participants 배열.\n- 의사코드:\n  final total = amount; final ratios = {uid1:0.5, uid2:0.5}; assert((ratios.values.reduce((a,b)=>a+b) - 1.0).abs() < 1e-6);\n  await client.from('expenses').insert({ 'group_id': gid, 'payer_id': uidPayer, 'amount': amount, 'currency': cur, 'description': desc, 'date': date.toIso8601String(), 'participants': ratios.entries.map((e)=>{'user_id':e.key,'ratio':e.value}).toList(), });",
        "testStrategy": "- 폼 검증(금액>0, 참가자≥2, 비율합=1) 위젯/단위 테스트.\n- 저장 성공 후 GroupPage 목록 즉시 갱신 확인.\n- 환율 누락 시 표시 폴백 동작 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "ExpensePage 폼 스캐폴딩 및 기본 필드/검증 구현",
            "description": "날짜, 금액, 통화, 부담자, 참가자, 메모 입력 필드를 갖춘 폼과 기본 검증을 구현합니다.",
            "dependencies": [],
            "details": "Form/GlobalKey 기반으로 TextFormField, Dropdown, DatePicker, 멤버 멀티선택 위젯을 배치하고 amount>0, 날짜/통화/부담자/참가자 필수 검증을 추가합니다. 생성/수정 모드를 고려해 초기값 주입과 상태 보존(IndexedStack)도 처리합니다.",
            "status": "pending",
            "testStrategy": "위젯 테스트로 필드 렌더링, 필수값 누락 시 에러 메시지 표출, 금액>0 검증을 확인합니다."
          },
          {
            "id": 2,
            "title": "Equal Split 토글 및 커스텀 분담 비율 에디터(합=1.0 검증)",
            "description": "균등 분배/커스텀 전환과 참가자별 비율 입력, 합계 1.0 검증을 구현합니다.",
            "dependencies": [
              1
            ],
            "details": "토글 전환 시 참가자 수로 1/n 자동 계산, 커스텀 모드에서는 슬라이더/숫자입력으로 ratio 편집을 제공하고 합계가 1.0(±1e-6)일 때만 저장 가능하도록 합니다. 참가자 추가/삭제 시 즉시 재분배, per-participant 금액 미리보기를 표시합니다.",
            "status": "pending",
            "testStrategy": "단위 테스트로 합계 허용 오차 검증, 위젯 테스트로 참가자 수 변경 시 자동 재분배/에러 메시지 노출을 확인합니다."
          },
          {
            "id": 3,
            "title": "participants jsonb 직렬화/역직렬화 유틸 및 DTO 변환",
            "description": "participants 배열(user_id, ratio)을 모델과 상호 변환하는 유틸을 작성합니다.",
            "dependencies": [
              1,
              2
            ],
            "details": "ParticipantShare(userId, ratio) 타입을 정의하고 toJson(List<ParticipantShare>) / fromJson(List<Map>) 유틸을 구현합니다. 순서 안정성 보장, ratio NaN/Infinity 방지, 빈/누락 필드에 대한 안전한 파싱을 포함합니다.",
            "status": "pending",
            "testStrategy": "JSON 라운드트립 테스트, 빈 배열/누락 키/잘못된 타입에 대한 예외/디폴트 처리 단위 테스트를 작성합니다."
          },
          {
            "id": 4,
            "title": "그룹 base_currency 기준 환율 표시 서비스 및 폴백 처리",
            "description": "환산 표시를 위해 환율 조회/변환 서비스를 구현하고 미존재 시 폴백 UI를 제공합니다.",
            "dependencies": [
              1
            ],
            "details": "ExchangeRatesRepository에서 base→target 변환, 동일 통화=1.0 처리, 해당 날짜 또는 최근 일자 선택 로직, 캐시 적용을 구현합니다. UI는 환율 미존재 시 N/A 표시와 안내 토스트를 제공합니다.",
            "status": "pending",
            "testStrategy": "모킹 리포지토리로 동일 통화/환율 존재/부재/과거 최신가 선택 케이스를 검증합니다."
          },
          {
            "id": 5,
            "title": "통화 스케일 기반 금액 계산 및 반올림 정책 유틸 확정",
            "description": "통화별 소수 자릿수 스케일과 반올림/잔여 분배 규칙을 정의하고 유틸로 제공합니다.",
            "dependencies": [
              2,
              4
            ],
            "details": "KRW/JPY=0, USD/EUR=2 등 스케일 매핑과 half-up 반올림을 기본으로 하며, 분배 총합 오차는 잔여 최소 단위를 일부 참가자에 배분해 총합=원금이 되도록 조정합니다. Decimal/정수 최소단위 기반 계산 인터페이스를 제공합니다.",
            "status": "pending",
            "testStrategy": "잔여 센트 배분, 스케일별 반올림, 총합 보존 성질을 단위 테스트로 확인합니다."
          },
          {
            "id": 6,
            "title": "expenses insert/update 리포지토리 메서드와 AppError 매핑",
            "description": "Supabase 연동으로 지출 생성/수정 API를 작성하고 오류를 도메인 에러로 변환합니다.",
            "dependencies": [
              3,
              5
            ],
            "details": "ExpenseRepository.create/update에서 participants 직렬화, date/amount/currency 필드 매핑, RLS/네트워크/유효성 오류를 AppError(permissionDenied, network, validation)로 매핑합니다. 반환 모델은 새로 생성/수정된 Expense DTO입니다.",
            "status": "pending",
            "testStrategy": "SupabaseClient 모킹으로 성공/실패 분기, 전달 파라미터 정확성, AppError 변환을 단위 테스트합니다."
          },
          {
            "id": 7,
            "title": "ExpensePage 저장 플로우 연결(생성/수정) 및 낙관적 갱신",
            "description": "제출 버튼을 리포지토리와 연결하고 성공/실패 UI 반응 및 낙관적 갱신을 구현합니다.",
            "dependencies": [
              1,
              2,
              3,
              4,
              5,
              6
            ],
            "details": "폼 검증 통과 시 ExpenseDraft 생성→repo 호출, 진행 중 버튼 비활성화/로딩 표시, 성공 시 로컬 상태에 즉시 반영하고 결과를 pop으로 전달, 실패 시 낙관적 변경 롤백 및 에러 스낵바/다이얼로그를 노출합니다.",
            "status": "pending",
            "testStrategy": "위젯 테스트로 로딩 상태, 성공 시 pop 결과/리스트 업데이트, 실패 시 롤백/에러 표시를 확인합니다."
          },
          {
            "id": 8,
            "title": "GroupPage 캐시 무효화/리프레시 및 잔액 재계산 연동",
            "description": "지출 저장/수정 후 그룹 리스트와 잔액이 즉시 반영되도록 캐시 무효화와 갱신을 구현합니다.",
            "dependencies": [
              7
            ],
            "details": "groupId별 expenses 캐시 invalidate, 최신 목록 재조회 또는 Realtime 적용, 잔액/밸런스 유틸을 호출해 합계를 재계산합니다. 네비게이션 복귀 시 onResult 콜백으로 강제 리프레시를 트리거합니다.",
            "status": "pending",
            "testStrategy": "통합 수준 위젯 테스트로 저장 후 뒤로가기 시 목록/잔액이 갱신되는지 확인합니다."
          },
          {
            "id": 9,
            "title": "접근성/키보드 UX 개선(포커스 이동, IME, 스크린리더 라벨)",
            "description": "입력 흐름을 매끄럽게 하고 접근성 라벨과 힌트를 적용해 사용성을 개선합니다.",
            "dependencies": [
              1,
              2,
              7
            ],
            "details": "숫자 키패드/소수점 허용, inputFormatters로 불필요 문자 차단, 다음 포커스 이동/완료 시 키보드 닫기, 토글/슬라이더/버튼에 Semantics 라벨/힌트 추가, 오류 메시지가 스크린리더로 노출되도록 합니다.",
            "status": "pending",
            "testStrategy": "Semantics 테스트로 라벨/힌트 존재, 금액 필드 키보드 타입/포맷 동작을 확인합니다."
          },
          {
            "id": 10,
            "title": "오류/권한 가드 추가 및 테스트 훅 정의(RLS 대응)",
            "description": "비회원/권한 부족/네트워크 오류에 대한 가드를 추가하고 테스트 훅을 정리합니다.",
            "dependencies": [
              6,
              7,
              8
            ],
            "details": "제출 전 현재 유저의 그룹 멤버십과 payer 포함 여부를 확인하고, AppError 유형별 가이드 메시지를 일관되게 노출합니다. 테스트 주입 가능한 Repository/Clock/ExchangeRate 훅과 fake 빌더를 마련합니다.",
            "status": "pending",
            "testStrategy": "권한 거부/네트워크 실패/검증 실패 시나리오를 단위/위젯 테스트로 재현하고 UI 반응을 검증합니다."
          }
        ],
        "complexity": 8,
        "recommendedSubtasks": 10,
        "expansionPrompt": "1) ExpensePage 폼(날짜/금액/통화/부담자/참가자/메모), 2) Equal split/커스텀 비율 편집기와 합=1.0 검증, 3) participants 배열 직렬화/역직렬화, 4) 환율 표시 유틸(그룹 base_currency 기준 환산) 및 폴백, 5) insert/update API와 optimistic 갱신, 6) 그룹 상세 리스트 반영/캐시 무효화, 7) 부동소수점/반올림 규칙, 8) 접근성/키보드 UX, 9) 단위/위젯 테스트, 10) 오류/권한 가드."
      },
      {
        "id": 7,
        "title": "정산 계산(Supabase Function) 연동",
        "description": "최소 송금 계산을 RPC로 호출해 미리보기/확정 저장을 구현합니다.",
        "details": "- RPC 계약: rpc_calculate_minimum_transfers(group_id) → [{from_user,to_user,amount}] 반환 가정.\n- UI: GroupPage ‘정산 계산’ 버튼→미리보기 다이얼로그→확정 시 settlements insert.\n- 의사코드:\n  final rows = await client.rpc('rpc_calculate_minimum_transfers', params:{'group_id': gid});\n  setState(()=>preview = rows);\n  // Confirm\n  await client.from('settlements').insert(rows.map((r)=>{...}).toList());",
        "testStrategy": "- 빈 결과/에러 처리.\n- 금액 반올림 표기 검증.\n- 동일 관계 상쇄(양방향 발생 시) 미리보기 검증(목업).",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Supabase RPC 래퍼 및 DTO 정의(rpc_calculate_minimum_transfers)",
            "description": "RPC 호출을 캡슐화하고 응답을 강타입 DTO로 변환합니다.",
            "dependencies": [],
            "details": "`rpc_calculate_minimum_transfers(group_id)` 호출 전용 리포지토리 메서드와 DTO(예: TransferPreview{int fromUser,int toUser,Decimal amount})를 정의합니다. Map→DTO 매퍼, null/타입 안전성 검증, 예외 래핑(네트워크/권한/서버 오류 메시지 표준화), 로깅 훅, 타임아웃 옵션, 취소 토큰을 포함합니다.",
            "status": "pending",
            "testStrategy": "샘플 페이로드로 매핑 유닛 테스트(정상/필드 누락/잘못된 타입), 예외 래핑 검증."
          },
          {
            "id": 2,
            "title": "금액 반올림 및 통화 표기 유틸리티 구현",
            "description": "정산 미리보기/저장에 사용될 반올림 및 표시 규칙을 제공합니다.",
            "dependencies": [],
            "details": "`roundAmount(amount,currency,{scale=2,mode=halfUp})`, `formatCurrency(amount,currency,locale)` 유틸을 구현합니다. -0.00 방지, 소수 자릿수 통일(통화별 스케일), 표시용과 저장용 분리, 미미 금액 임계치 필터(`isNegligible`) 포함. intl NumberFormat 사용.",
            "status": "pending",
            "testStrategy": "반올림 경계값(0.005/0.0049), 음수/양수, 통화별 소수 자리, -0.00 제거 케이스 테스트."
          },
          {
            "id": 3,
            "title": "GroupPage ‘정산 계산’ 버튼 및 미리보기 다이얼로그 구현",
            "description": "버튼 클릭 시 RPC 호출→로딩/결과/빈 상태를 표시하는 다이얼로그를 만듭니다.",
            "dependencies": [
              1,
              2
            ],
            "details": "GroupPage 상단/적절 위치에 ‘정산 계산’ 버튼 추가. 클릭→Repository.calculate 호출→state에 preview 저장. 다이얼로그에 송금 리스트(From→To, 금액 포맷팅), 로딩/에러/빈 상태, 재시도 버튼, ‘확정’/‘취소’ 액션 제공. 상태는 페이지 재진입 시 유지하도록 간단한 상태관리(예: Provider/ChangeNotifier) 사용.",
            "status": "pending",
            "testStrategy": "위젯 테스트로 로딩→결과 전환, 빈 결과 메시지, 에러 스낵바/다이얼로그 재시도 버튼 동작 확인(모킹)."
          },
          {
            "id": 4,
            "title": "확정 시 settlements 일괄 insert 및 의사 트랜잭션 처리",
            "description": "미리보기 확정 시 settlements 테이블에 일괄 저장하고 부분 실패를 방지/복구합니다.",
            "dependencies": [
              3
            ],
            "details": "미리보기 행을 `{group_id,from_user,to_user,amount,currency,status:'pending',memo}`로 매핑하여 단일 insert 호출. 중복 방지 키(예: group_id+세션 기반 nonce) 또는 서버측 UPSERT 제약을 고려. 실패 시 이미 삽입된 레코드 삭제 보정(가능 시), 확정 버튼 비활성화 및 진행 표시, 성공 후 목록/잔액 리프레시 트리거.",
            "status": "pending",
            "testStrategy": "리포지토리 모킹으로 성공/부분 실패/전체 실패 시 버튼 상태, 재시도, 롤백 삭제 호출 유무 검증."
          },
          {
            "id": 5,
            "title": "빈/에러/양방향 상쇄 및 미미 금액 처리 UX 개선",
            "description": "특수 케이스에서 사용자가 혼란 없도록 가시성과 제어 옵션을 제공합니다.",
            "dependencies": [
              3
            ],
            "details": "양방향 쌍(A→B,B→A) 존재 시 순액 상쇄 표시 토글 제공, 임계치 미만 금액 숨기기 옵션, 빈 결과 시 ‘정산할 항목 없음’ 일러스트/가이드, 에러 상세와 재시도/문의 버튼, 리스트 정렬(금액↓/이름) 및 접근성 레이블링.",
            "status": "pending",
            "testStrategy": "목업 데이터로 상쇄 토글 on/off 비교 스냅샷, 임계치 필터 동작, 빈/에러 화면 표시 검증."
          },
          {
            "id": 6,
            "title": "모킹 기반 테스트 포인트 구성 및 예시 케이스 추가",
            "description": "RPC/리포지토리/포맷 유틸을 모킹하여 주요 플로우 테스트 지점을 구성합니다.",
            "dependencies": [
              1,
              2,
              3,
              4,
              5
            ],
            "details": "Supabase 클라이언트/리포지토리 인터페이스 추출→mocktail 등으로 모킹. 유닛: DTO 매핑, 반올림/포맷. 위젯: 버튼→미리보기→확정 플로우, 에러/빈/오프라인. 통합 수준: 일괄 insert 매핑과 상태 업데이트 호출 시퀀스 검증. 테스트 데이터 빌더/픽스처 정리.",
            "status": "pending",
            "testStrategy": "유닛/위젯 테스트 설계서 작성 및 스켈레톤 코드 추가(실행은 생략). 실패 시나리오 우선 설계."
          }
        ],
        "complexity": 6,
        "recommendedSubtasks": 6,
        "expansionPrompt": "1) RPC 클라이언트 래퍼와 타입 매핑, 2) GroupPage ‘정산 계산’ 버튼/미리보기 다이얼로그, 3) 반올림/표시 규칙, 4) 확정 시 settlements insert 트랜잭션 처리, 5) 빈/에러/양방향 상쇄 처리, 6) 모킹 기반 단위 테스트."
      },
      {
        "id": 8,
        "title": "정산 상태 실시간 추적 및 요청 화면군",
        "description": "Supabase Realtime 구독으로 settlements 상태를 실시간 반영하고 RequestRegister/List/Detail 화면에서 상태 전이를 제공합니다.",
        "details": "- settlements 테이블에 status(pending/paid/rejected/rolled_back) 가정.\n- Realtime 구독 의사코드:\n  final ch = supabase.channel('public:settlements').on(PostgresChangeEvent.update, ChannelFilter(table:'settlements',schema:'public',filter:'group_id=eq.$gid'), (payload){ setState(()=>applyChange(payload)); }).subscribe();\n- RequestRegisterPage: 계산 결과로 pending 생성.\n- RequestListPage: 상태 필터 탭.\n- RequestPage: paid/rejected/rolled_back 업데이트와 롤백 처리.",
        "testStrategy": "- 상태 전이 단위 테스트(pending→paid/rejected→rolled_back).\n- 구독 해제/재구독 시 메모리 누수 없음을 확인.\n- 오프라인 후 재연결 시 동기화 확인(재조회 트리거).",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Supabase Realtime 채널 유틸(구독/해제/재구독) 구현",
            "description": "settlements 테이블의 그룹별 실시간 업데이트를 수신하는 채널 유틸을 설계·구현합니다.",
            "dependencies": [],
            "details": "Supabase Flutter로 `public:settlements` 채널을 생성하고 update/insert 이벤트를 group_id 필터로 구독합니다. 단일 그룹당 단일 채널 보장, 중복 구독 방지, unsubscribe/cleanup 제공. 연결 끊김 감지 시 자동 재구독 옵션 포함. 스트림 인터페이스로 UI에서 listen 가능하도록 노출.",
            "status": "pending",
            "testStrategy": "모킹으로 구독→이벤트 수신→해제 시 콜백 미호출 확인. 그룹 전환 시 이전 채널 해제 보장. 필터 쿼리 문자열 검증."
          },
          {
            "id": 2,
            "title": "RequestRegister/List/Detail 실시간 반영 및 캐시 병합",
            "description": "요청 생성/목록/상세 화면에서 구독 이벤트를 로컬 캐시와 병합하여 즉시 반영합니다.",
            "dependencies": [
              1,
              3
            ],
            "details": "채널 유틸 스트림을 상태관리(예: ChangeNotifier/Riverpod)로 연결. key=id 기반 머지(upsert), 본인이 트리거한 변경은 낙관적 업데이트와 서버 이벤트 중복 처리 방지. RequestRegister는 pending 생성 후 캐시 선반영, List는 상태별 섹션 필터, Detail은 단건 상태/타임라인 실시간 갱신.",
            "status": "pending",
            "testStrategy": "가짜 이벤트 시퀀스로 insert→update 순서 교란 시 캐시 정합성 확인. 낙관적 업데이트 후 서버 이벤트 중복 제거 검증."
          },
          {
            "id": 3,
            "title": "정산 상태 enum/매퍼 작성(pending/paid/rejected/rolled_back)",
            "description": "DB 문자열과 Dart enum 간 양방향 매핑 및 UI 표현을 정의합니다.",
            "dependencies": [],
            "details": "Dart enum `SettlementStatus { pending, paid, rejected, rolledBack }`와 JsonConverter를 작성하여 DB 값 `rolled_back`을 코드의 `rolledBack`과 매핑. 뱃지 색상/라벨 매퍼, 상태 전이 가능한 액션 맵(pending→paid/rejected, paid/rejected→rolled_back) 정의.",
            "status": "pending",
            "testStrategy": "문자열↔enum 직렬화/역직렬화 단위 테스트, 전이 불가 케이스 가드 로직 검증."
          },
          {
            "id": 4,
            "title": "오프라인 복구: 재연결 시 재조회 및 동기화 트리거",
            "description": "네트워크 재연결 또는 앱 복귀 시 최신 정산 상태를 재조회하여 동기화합니다.",
            "dependencies": [
              1,
              3
            ],
            "details": "connectivity_plus 또는 Supabase 연결 상태를 구독해 online 전환 시 그룹별 settlements를 `updated_at > lastSyncAt` 조건으로 증분 조회. 누락 이벤트를 캐치업하고 로컬 캐시에 머지. 재조회 실패 시 지수 백오프 재시도 및 마지막 성공 시각 업데이트.",
            "status": "pending",
            "testStrategy": "오프라인 큐 시뮬레이션 후 online 전환 시 증분 재조회가 호출되고 캐시가 최신화되는지 확인. 백오프 간격 계산 검증."
          },
          {
            "id": 5,
            "title": "수명주기/메모리 누수 가드 및 정리 로직",
            "description": "위젯 수명주기와 앱 상태 변화에 따른 구독 해제/정리를 보장합니다.",
            "dependencies": [
              1,
              2,
              4
            ],
            "details": "RouteAware/WidgetsBindingObserver로 페이지 pop, 탭 전환, 앱 pause 시 채널 정리 또는 일시 중지. dispose에서 모든 StreamSubscription과 Timer 취소. 그룹 변경 시 이전 리소스 해제 후 새 채널로 스왑. mounted 체크 및 Context 보관 금지 원칙 적용.",
            "status": "pending",
            "testStrategy": "위젯 마운트/언마운트 반복 시 구독 카운트가 증가하지 않음을 측정. 그룹 전환 후 이전 채널 이벤트 미수신 확인."
          },
          {
            "id": 6,
            "title": "에러 처리: 리트라이, 사용자 토스트/스낵바, 로깅",
            "description": "구독/재조회/상태 업데이트 오류에 대한 사용자 피드백과 재시도 정책을 구현합니다.",
            "dependencies": [
              1,
              2,
              4
            ],
            "details": "일시적 오류에 지수 백오프 재시도, 영구 오류는 즉시 토스트/스낵바와 재시도 버튼 제공. 상태 업데이트 실패 시 낙관적 반영 롤백. 공통 ErrorMapper와 Logger(분기별 tag) 도입, UX 메시지 가이드라인 통일.",
            "status": "pending",
            "testStrategy": "강제 예외 던져 재시도 횟수·간격 검증, 롤백 후 UI 일관성 확인, 사용자 피드백 노출 조건 테스트."
          },
          {
            "id": 7,
            "title": "위젯/단위 테스트 포인트 정의 및 샘플 테스트 스텁",
            "description": "핵심 시나리오에 대한 테스트 항목과 스텁 코드를 정리합니다.",
            "dependencies": [
              1,
              2,
              3,
              4,
              5,
              6
            ],
            "details": "시나리오: pending→paid/rejected→rolled_back 전이, 실시간 이벤트로 List/Detail 동기 갱신, 오프라인→온라인 증분 동기화, 구독 해제 후 메모리 누수 없음, 필터 탭 반영. 테스트 유틸로 가짜 채널 소스/페이로드 빌더와 골든 스크린샷 스텁 제공.",
            "status": "pending",
            "testStrategy": "테스트 실행은 생략하되 케이스 명세서와 모킹 전략 문서화, 샘플 테스트 파일 골격 생성."
          }
        ],
        "complexity": 6,
        "recommendedSubtasks": 7,
        "expansionPrompt": "1) Supabase Realtime 구독 채널 구성/해제, 2) RequestListTab/RequestPage에 실시간 반영(캐시 병합), 3) 상태 전이(pending→paid|rejected|rolled_back) 맵핑과 현재 enum(completed/declined) 정렬, 4) 오프라인 재연결 시 재조회, 5) 메모리 누수/수명주기 가드, 6) 에러 리트라이/토스트, 7) 위젯 테스트(상태 전이)."
      },
      {
        "id": 9,
        "title": "송금 액션(플레이스홀더) 및 계좌 복사",
        "description": "실제 결제 연동 전까지 계좌 복사/외부 앱 열기 동작과 향후 결제 API 인터페이스를 준비합니다.",
        "details": "- PaymentProvider 인터페이스 정의: pay(Settlement s) → Future<PaymentResult>.\n- Kakao/Toss 스텁 구현(미사용, 훅만 노출).\n- RequestPage ‘송금하기’: Clipboard.setData(bankAccount) + launchUrl(카카오/토스 스킴) 시도.\n- 실패 시 안내 및 수동 paid 처리 버튼 유지.",
        "testStrategy": "- URL 스킴 실패 예외 처리 경로 확인.\n- 클립보드 복사 토스트 표시 테스트.\n- Provider 스텁 모킹 컴파일 안정성 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "PaymentProvider/PaymentResult 타입 및 상태 enum 설계",
            "description": "향후 결제 연동을 위한 공통 인터페이스와 결과 타입을 정의합니다.",
            "dependencies": [],
            "details": "lib/core/payments/payment_provider.dart에 PaymentProvider { Future<PaymentResult> pay(Settlement s) } 인터페이스와 PaymentResult(status: success|canceled|failed, message, errorCode, raw?)를 정의합니다. 상태 enum(PaymentStatus)과 기본 에러 타입(PaymentException) 포함. 초기 구현체 없이 DI 주입 포인트만 마련하고, null provider 대비 가드 메서드도 제공해 RequestPage에서 안전하게 호출 가능하게 합니다.",
            "status": "pending",
            "testStrategy": "정적 점검 중심: flutter analyze로 타입/임포트 오류 확인, 간단한 더미 구현으로 pay() 호출 컴파일 확인(실행 테스트 생략)."
          },
          {
            "id": 2,
            "title": "카카오/토스 URL 스킴 런처 스텁 구현 및 매니페스트 질의 등록",
            "description": "카카오페이/토스 스킴 생성과 launchUrl 시도를 담당하는 스텁을 만듭니다.",
            "dependencies": [
              1
            ],
            "details": "lib/core/payments/providers/kakao_pay_provider.dart, toss_pay_provider.dart 파일로 각 PaymentProvider 스텁 구현. Settlement와 수취인 계좌 정보를 문자열로 조합해 kakaopay://, supertoss:// 등의 플레이스홀더 URI를 생성하고, launchUrl(LaunchMode.externalApplication) 시도 전 canLaunchUrl 유사 가드 처리. iOS Info.plist LSApplicationQueriesSchemes와 Android manifest queries 요소에 대상 스킴(kakaopay, supertoss 등) 질의 추가 주석을 남겨 추후 설정 반영 용이하게 문서화합니다(실제 결제 호출 아님). 실패 시 PaymentResult.failed 반환.",
            "status": "pending",
            "testStrategy": "수동 점검 지침: 스킴 미설치 기기에서 실패 경로가 PaymentResult.failed로 귀결되는지 로그로 확인(실행 테스트는 생략)."
          },
          {
            "id": 3,
            "title": "RequestPage ‘송금하기’ 플로우(계좌 복사 + 외부 앱 열기 + 실패 가드)",
            "description": "송금 버튼 탭 시 클립보드 복사와 외부 앱 열기를 시도하고 실패 시 안내를 표시합니다.",
            "dependencies": [
              1,
              2
            ],
            "details": "lib/features/requests/request_page.dart에 송금하기 버튼 핸들러 추가. 1) 수취인 계좌 문자열(은행/계좌번호/예금주) 생성 후 Clipboard.setData로 복사 및 스낵바 토스트 표시. 2) 선택된(provider 미선택 시 기본) Kakao/Toss 스텁의 pay() 호출로 URL 스킴 실행 시도. 3) pay()가 canceled/failed면 안내 다이얼로그와 함께 ‘수동 완료’ 옵션을 제시. 4) 예외 전역 가드(try/catch)로 UI 프리즈 방지, 중복 탭 방지를 위한 로딩 상태 관리. 계좌 정보가 없을 경우 복사/런치 전 단계에서 친절한 가이드 문구 제공.",
            "status": "pending",
            "testStrategy": "UI 수동 체크 시나리오 문서화: 버튼 탭→클립보드 성공 토스트, 스킴 실패→안내 다이얼로그 노출 흐름 확인(자동 테스트는 생략)."
          },
          {
            "id": 4,
            "title": "수동 완료/롤백 버튼 및 정산 상태 업데이트 이벤트 연결",
            "description": "송금 완료/거절/롤백 버튼을 추가하고 settlements 상태 업데이트와 화면 반영을 연결합니다.",
            "dependencies": [
              3
            ],
            "details": "RequestPage에 ‘송금 완료’, ‘거절’, ‘롤백’ 액션 버튼을 배치하고 SettlementRepository.updateStatus(id, status) 유즈케이스(또는 서비스)에 연결하여 paid/pending/rejected 상태로 전환. 낙관적 업데이트와 실패 시 스낵바 Undo 제공. 상태 변경 시 상위 리스트(RequestListPage)와 그룹 잔액 섹션이 새로 고침되도록 프로바이더/노티파이어 이벤트를 발행. 권한/유효성(본인 from_user만 완료 가능 등)은 가드만 마련하고 실제 정책은 추후 확장.",
            "status": "pending",
            "testStrategy": "상태 전환 수동 시나리오: 완료→리스트 반영, 롤백→원복 확인. 예외 시 안내 및 Undo 토스트 표시(실행은 생략)."
          }
        ],
        "complexity": 4,
        "recommendedSubtasks": 4,
        "expansionPrompt": "1) PaymentProvider 인터페이스/결과 타입 정의, 2) 카카오/토스 URL 스킴 런처 스텁, 3) RequestPage에 ‘송금하기’ 액션 추가(Clipboard+launchUrl), 4) 실패 시 안내 및 수동 완료 처리 버튼 유지/가드."
      },
      {
        "id": 10,
        "title": "프로필/계좌 관리(User Metadata) 및 포맷팅",
        "description": "ProfilePage에서 실명/닉네임/계좌 정보를 Supabase Auth user_metadata로 저장/로드하고 통화/날짜 포맷 일관성을 적용합니다.",
        "details": "- Supabase Auth 업데이트:\n  await supabase.auth.updateUser(UserAttributes(data:{'real_name':name,'nickname':nick,'bank_account':account}));\n- 표시 시 일부 마스킹 처리.\n- 통화/날짜 포맷: intl NumberFormat.currency, DateFormat.yMMMd 지역화 반영.\n- RequestPage에서 수신자 계좌 표시 연동.",
        "testStrategy": "- 저장 후 재진입 값 복원 테스트.\n- 누락/부분 입력 시 검증 메시지 확인.\n- RequestPage에 계좌 표시 및 마스킹 렌더링 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Supabase Auth user_metadata 로드/저장 유틸 구현",
            "description": "실명/닉네임/계좌 정보를 Auth user_metadata로 안전하게 로드·저장하는 서비스 모듈을 작성합니다.",
            "dependencies": [],
            "details": "`lib/services/user_metadata_service.dart`에 load/save/merge 메서드 구현. `supabase.auth.getUser()`로 현재 메타데이터를 읽고, `updateUser(UserAttributes(data:{real_name,nickname,bank_account}))`로 저장. null/부분 입력 처리, 기본 스키마 키 정의, 단순 캐시와 에러 매핑 포함.",
            "status": "pending",
            "testStrategy": "의존성 분리 후 Supabase 클라이언트 모킹으로 저장/로드 성공/오류/부분필드 케이스 단위테스트 설계. 수동으로 저장→재조회 확인."
          },
          {
            "id": 2,
            "title": "users 테이블 병행/이행 전략 수립 및 동기화 함수 작성",
            "description": "Auth 메타데이터와 users 테이블 간 일관성 확보를 위한 마이그레이션/동기화 로직을 설계·구현합니다.",
            "dependencies": [
              1
            ],
            "details": "소스오브트루스는 Auth user_metadata로 정의. 최초 로그인 시 users 테이블에서 누락 필드만 보충, 충돌 발생 시 최신 updated_at 우선. `lib/services/user_profile_sync.dart`에 `syncOnSignIn()`/`backfillIfMissing()` 구현.",
            "status": "pending",
            "testStrategy": "시나리오 기반: (1) users만 값 존재 (2) metadata만 존재 (3) 상충 값 존재. 실행 후 최종값 일관성 수동 검증 및 로깅 확인."
          },
          {
            "id": 3,
            "title": "ProfilePage 계좌 마스킹/복사 UX 및 입력 검증 추가",
            "description": "계좌번호 마스킹 표시, 전체 복사, 필수 필드 검증과 저장 후 피드백을 구현합니다.",
            "dependencies": [
              1,
              2
            ],
            "details": "마스킹 규칙 예: 앞 2자리+중간 * 처리+끝 4자리 노출. `Clipboard.setData`로 복사, SnackBar/Toast 피드백. 필수: 실명/닉네임/계좌 형식 검증 및 오류 메시지. 저장 시 user_metadata_service 사용.",
            "status": "pending",
            "testStrategy": "UI 수동 테스트: 마스킹 노출 규칙, 복사 버튼 동작, 필수값 누락 시 검증 메시지, 저장 성공/실패 토스트 확인."
          },
          {
            "id": 4,
            "title": "통화/날짜 포맷 공통 유틸 작성 및 지역화 연결",
            "description": "intl 기반 통화/날짜 포맷 유틸을 공통 모듈로 제공하고 로케일을 반영합니다.",
            "dependencies": [],
            "details": "`lib/utils/formatters.dart`에 `formatCurrency(amount,currency,locale)`(NumberFormat.currency)와 `formatDate(date,locale)`(DateFormat.yMMMd) 작성. 로케일은 앱 설정/플랫폼 로케일 참조, 반올림 및 기호 표기 옵션 포함.",
            "status": "pending",
            "testStrategy": "다국어 로케일 샘플 값으로 포맷 결과 확인(USD/KRW/EUR). 경계값(0, 소수) 및 긴 날짜 검증을 수동 점검."
          },
          {
            "id": 5,
            "title": "RequestPage 수신자 계좌 표시 연동(메타데이터+마스킹/복사)",
            "description": "정산 상세에 수신자(to_user) 계좌를 메타데이터에서 로드해 마스킹/복사 기능과 함께 표시합니다.",
            "dependencies": [
              1,
              2,
              3,
              4
            ],
            "details": "settlement의 to_user 기준으로 user_metadata 로드. 값 없으면 users/은행계좌 테이블 폴백. `formatters.dart`로 금액/날짜 표기 일관화. 마스킹/복사 UX는 ProfilePage와 동일 컴포넌트 재사용.",
            "status": "pending",
            "testStrategy": "정산 상세에서 수신자 계좌 노출, 마스킹 규칙 일치, 복사 동작, 메타데이터 누락 시 폴백 표시를 수동 확인."
          },
          {
            "id": 6,
            "title": "저장 후 재진입 복원/검증 훅(Provider/Notifier) 구현",
            "description": "프로필 저장 직후와 앱 재진입 시 값 자동 복원과 필드 상태 검증을 담당하는 상태 훅을 구현합니다.",
            "dependencies": [
              1,
              2,
              3
            ],
            "details": "`lib/state/profile_controller.dart`에 Provider/ChangeNotifier로 onInit→metadata 로드, onSave→재로드, 에러 상태/검증 메시지 관리. 앱 재시작 시 마지막 저장값 반영, 부분 입력 플래그 유지.",
            "status": "pending",
            "testStrategy": "저장→페이지 나갔다 재진입 시 값 복원, 부분 입력 상태 유지, 오류 발생 시 메시지 유지 여부를 수동 시나리오로 확인."
          }
        ],
        "complexity": 5,
        "recommendedSubtasks": 6,
        "expansionPrompt": "1) Supabase Auth user_metadata 로드/저장 유틸 추가, 2) 기존 users 테이블 업데이트와 메타데이터 병행/이행 전략, 3) 계좌 표시 마스킹/복사 UX 정리, 4) intl 통화/날짜 포맷 유틸 공통화, 5) RequestPage 수신자 계좌 표시 연동, 6) 저장 후 재진입 복원/유효성 검증 테스트."
      },
      {
        "id": 11,
        "title": "Clean Architecture 리팩토링: 레이어/리포지토리/유즈케이스/에러/공통 컴포넌트",
        "description": "현 구조(lib/main.dart의 딥링크/인증 콜백 과도 집중, common/services의 직접 Supabase 접근)를 Clean Architecture로 재구성합니다. 레이어 분리, 리포지토리/유즈케이스 도입, 에러 처리 통일, 공통 컴포넌트/유틸리티 구축 및 Provider 정의 분리를 수행합니다.",
        "details": "현황 분석(코드 기준)\n- 딥링크/인증: lib/main.dart 내 MyAppState에서 AppLinks + 인증 콜백을 직접 처리(딥링크 파싱/분기/네비게이션 포함).\n- 서비스: lib/common/services/*(auth_service.dart, group_service.dart, request_service.dart, ...)에서 SupabaseClient를 직접 사용하며 Provider를 파일 하단에 정의.\n- 라우팅: lib/app_router.dart(go_router), 하단 탭: lib/features/home/home_page.dart(IndexedStack + NavigationBar).\n- 환경: lib/config/environment.dart에서 .env 로드 및 Supabase Redirect URI 조립.\n\n목표 구조(새 디렉터리/파일)\n- core(플랫폼 독립/공통):\n  - lib/core/errors/app_error.dart(AppError, AppErrorCode, toFriendlyMessage)\n  - lib/core/result/result.dart(Result<T>, Success/Failure)\n  - lib/core/deeplink/deep_link_handler.dart(딥링크 파서/분기/콜백 인터페이스)\n  - lib/core/auth/auth_callback_handler.dart(OAuth 콜백 처리기)\n  - lib/core/di/providers.dart(공용 Provider 집약: SupabaseClient, Repositories, UseCases)\n- domain(비즈니스 규칙):\n  - lib/domain/repositories/*.dart(GroupRepository, RequestRepository, AuthRepository 등 인터페이스)\n  - lib/domain/usecases/*.dart(JoinGroupByInviteCodeUseCase, GetUserGroupsUseCase, FetchRequestsUseCase, UpdateRequestStatusUseCase 등)\n- data(외부 연동 구현):\n  - lib/data/repositories/*_repository_impl.dart(Supabase 기반 구현: 기존 Service 대체)\n- presentation(선택적):\n  - lib/presentation/widgets/common_snackbar.dart, async_value_extensions.dart(공통 UI/유틸)\n\n구현 단계\n1) 에러 처리 통일(core/errors, core/result)\n- app_error.dart: AppErrorCode(enum: network, auth, permission, notFound, invalidLink, conflict, unknown), AppError(code, message, cause) + toFriendlyMessage(Locale?)\n- result.dart: sealed-like Result<T> = Success<T>(value) | Failure<T>(AppError)\n- 변환 규칙: SupabaseException/http 오류/FormatException → AppError 매핑 함수\n\n2) 리포지토리 인터페이스(domain/repositories)\n- group_repository.dart: createGroup(name, baseCurrency), joinByInviteCode(code), getUserGroups(), getGroupDetail(id), getGroupMembers(id)\n- request_repository.dart: fetchRequests(userId, status?), fetchRequest(id), createRequest(...), updateStatus(id, status)\n- auth_repository.dart(경량): signIn(provider), signOut(), syncUserProfile()\n\n3) 리포지토리 구현(data/repositories)\n- group_repository_impl.dart: 기존 lib/common/services/group_service.dart 로직을 이동/재사용하되 Result<AppError> 반환으로 래핑. SupabaseClient 주입.\n- request_repository_impl.dart: 기존 request_service.dart 이동/재사용, Result 기반 반환으로 일원화.\n- auth_repository_impl.dart: 기존 auth_service.dart 로그인/로그아웃/프로필 동기화 래핑.\n- 마이그레이션 전략: 1차는 기존 Service를 내부적으로 호출하는 어댑터를 제공해 UI 변경 영향 최소화(점진적 교체). 예) GroupRepositoryImpl이 내부 private GroupService를 사용하고, 예외→AppError 변환.\n\n4) 유즈케이스(domain/usecases)\n- JoinGroupByInviteCodeUseCase(GroupRepository)\n- GetUserGroupsUseCase(GroupRepository)\n- FetchRequestsUseCase(RequestRepository)\n- UpdateRequestStatusUseCase(RequestRepository)\n- 각 유즈케이스는 call(...) → Future<Result<T>> 형태로 구현\n\n5) Provider 정의 분리(core/di/providers.dart)\n- supabaseClientProvider(Supabase.instance.client)\n- 각 Repository Provider: groupRepositoryProvider, requestRepositoryProvider, authRepositoryProvider\n- 각 UseCase Provider: joinGroupByInviteCodeUseCaseProvider 등\n- 기존 서비스 파일 하단 Provider는 deprecated 주석 후 providers.dart로 위임/재노출(단계적 제거).\n\n6) 딥링크/인증 로직 분리(main.dart 경량화)\n- core/deeplink/deep_link_handler.dart: parseHomeTabUri/maybeParseInviteCode/isGroupInviteUri 등 기존 main.dart 로직 이동. handle(Uri) → Future<void>로 설계하여 네비게이션·스낵바는 콜백(예: onNavigate(String route), onToast(String))으로 주입.\n- core/auth/auth_callback_handler.dart: _isSupportedAuthCallback, callback 처리 및 AuthRepository 연동으로 리팩터링.\n- main.dart: MyAppState에서는 AppLinks 구독만 담당. onUri 수신 시 AuthCallbackHandler → DeepLinkHandler 순서로 처리. 네비게이션은 appRouter.go를 넘기는 onNavigate로 주입. 기존 _safeNavigate/_showDeepLinkMessage는 공통 util로 대체.\n- app_router.dart는 변경 최소화(라우트 path 그대로 유지).\n\n7) 공통 컴포넌트/유틸리티\n- presentation/widgets/common_snackbar.dart: showInfo(context, msg), showError(context, msg)\n- common/utils/format.dart(또는 presentation/utils): 통화/날짜 포맷 래퍼(intl 사용) — 기존 요구와 합치되나, 현 pubspec에 codegen 도구 없음 → 경량 함수로 구현\n- riverpod AsyncValue UI 확장: AsyncValue<T>.onSuccess/OnError 헬퍼(선택)\n\n8) UI 적용 최소 변경 포인트\n- features/home/home_page.dart: FAB에서 requestListProvider 사용 중 → providers.dart에서 request 관련 usecase 기반 Provider를 노출하는 어댑터 추가(requestListProvider 유지하되 내부 구현만 교체)\n- features/group/group_page.dart, features/requests/*: 동일 전략으로 기존 Provider 유지 + 내부 의존을 Repository/UseCase로 천천히 전환\n\n파일 단위 가이드(핵심 예)\n- lib/main.dart: MyAppState._listenToDeepLinks/_handleDeepLink/_handleGroupInvite/_handleHomeTabLink/_isSupportedAuthCallback → 각각 DeepLinkHandler/AuthCallbackHandler로 이동. MyApp은 ProviderScope에서 handler를 읽어 콜백만 연결.\n- lib/common/services/group_service.dart, request_service.dart, auth_service.dart: 로직은 data/repositories/*_impl.dart로 이동 후 여기서는 @Deprecated 주석 + 새 Provider 재노출만 유지(중간 호환층).\n- lib/app_router.dart, lib/config/environment.dart: 변경 없음(경로/환경 유지).\n\n리스크/마이그레이션\n- 대규모 이동으로 import 경로 변경 다수 발생 가능 → 1차 릴리스에서는 Service→Repository 어댑터 병행으로 컴파일 안정성 우선.\n- 코드젠 라이브러리(freezed/json_serializable) 미사용(현 pubspec에 미포함). 추후 별도 태스크로 도입.\n",
        "testStrategy": "정적 점검\n- flutter analyze 무경고 확인(임시 @Deprecated 허용).\n- 모든 새/이동 파일이 올바른 import를 사용하고 순환 참조가 없는지 확인.\n\n부팅/네비게이션\n- 앱 부팅 후 /splash → /home 라우팅 정상 동작.\n- 로그인 전 splitbills://invite?code=TEST 링크 수신 시 /auth로 이동하고 토스트 노출.\n- 로그인 후 동일 링크 수신 시 그룹 가입 성공 → /groups/:id로 이동.\n\n인증 콜백\n- splitbills://auth/google?state=... 및 legacy tricount://auth/google?state=... 형식 콜백을 AuthCallbackHandler로 전달 시 세션 생성/프로필 동기화 호출 경로가 실행되고 Result 성공 시 홈으로 이동.\n- 실패/예외(FormatException, 네트워크) 시 AppError 매핑 및 사용자 친화 메시지 스낵바 표시.\n\n리포지토리/유즈케이스\n- userGroups 조회: Home 진입 시 기존 userGroupsProvider가 정상 데이터 수신(내부 구현이 repository 기반으로 전환됨을 확인).\n- 요청 목록: Requests 탭에서 상태 필터 시 정상 목록/에러 메시지 노출 확인.\n- 상태 업데이트: RequestPage에서 updateStatus 호출 시 성공/실패 경로 각각 스낵바/토스트 확인.\n\n회귀 확인\n- Group 생성/초대 링크 생성 기능 기존과 동일 동작.\n- 기존 services Provider를 사용하는 화면이 모두 컴파일/런타임 정상(어댑터 유지로 보장).",
        "status": "done",
        "dependencies": [
          "1"
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "공통 컴포넌트 생성",
            "description": "ErrorView, LoadingView, EmptyStateView, InfoRow 위젯 생성 및 기존 중복 코드 제거",
            "details": "- lib/presentation/widgets/common/error_view.dart: 에러 표시 위젯 (현재 _GroupErrorView 등 중복 제거)\n- lib/presentation/widgets/common/loading_view.dart: 로딩 표시 위젯\n- lib/presentation/widgets/common/empty_state_view.dart: 빈 상태 표시 위젯\n- lib/presentation/widgets/common/info_row.dart: 정보 행 표시 위젯 (현재 _InfoRow 중복 제거)\n- 기존 코드에서 중복된 위젯을 새 공통 컴포넌트로 교체",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "유틸리티 함수 생성",
            "description": "date_formatter, snackbar_helper, clipboard_helper, share_helper, currency_formatter 생성",
            "details": "- lib/core/utils/date_formatter.dart: 날짜 포맷팅 (현재 여러 곳에 중복)\n- lib/core/utils/snackbar_helper.dart: SnackBar 표시 헬퍼\n- lib/core/utils/clipboard_helper.dart: 클립보드 복사 헬퍼\n- lib/core/utils/share_helper.dart: 공유 기능 헬퍼\n- lib/core/utils/currency_formatter.dart: 통화 포맷팅\n- 기존 코드에서 중복된 유틸리티 로직을 새 헬퍼로 교체",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "상수 정의",
            "description": "app_constants, route_constants, currency_constants 파일 생성 및 하드코딩된 값 제거",
            "details": "- lib/core/constants/app_constants.dart: 앱 전역 상수\n- lib/core/constants/route_constants.dart: 라우트 경로 상수\n- lib/core/constants/currency_constants.dart: 통화 목록 상수 (현재 GroupCreatePage에 하드코딩)\n- 기존 코드에서 하드코딩된 값들을 상수로 교체\n<info added on 2025-11-07T16:17:59.041Z>\n구현 완료 사항\n- 상수 파일 생성 및 배럴 추가\n  - lib/core/constants/route_constants.dart: splash/auth/home/groupCreate/requestRegister 및 OAuth 콜백 경로 정의, 상세 경로 빌더(groupDetail(id), requestDetail(id)) 제공\n  - lib/core/constants/currency_constants.dart: 지원 통화 목록(KRW, USD, EUR, JPY, CNY, GBP) 및 기본 통화(KRW) 정의\n  - lib/core/constants/app_constants.dart: 그룹 이름 최대/최소 길이, 기본/대/소 패딩, 네트워크 타임아웃, 딥링크 스킴/호스트/파라미터 상수 정의\n  - lib/core/constants/constants.dart: 위 상수 일괄 export\n\n- 기존 코드 교체 적용\n  - lib/features/group/group_create_page.dart\n    - 통화 드롭다운 항목: CurrencyConstants.supportedCurrencies 사용\n    - 기본 통화: CurrencyConstants.defaultCurrency 사용\n    - 그룹명 검증: AppConstants.maxGroupNameLength 사용\n    - 라우팅: context.go(RouteConstants.home)로 변경\n    - import 정리: core/constants/constants.dart 배럴 사용\n  - lib/features/group/group_page.dart\n    - 기본 통화 fallback: CurrencyConstants.defaultCurrency 사용\n    - import 정리: core/constants/constants.dart 배럴 사용\n  - lib/app_router.dart\n    - 초기 경로 및 정적 경로: RouteConstants.splash/auth/home/groupCreate/requestRegister/authKakao/authGoogle/authApple 사용\n    - 상세 경로 이동 시 사용을 위한 RouteConstants.groupDetail()/requestDetail() 제공\n\n린트\n- import 정리 및 const 사용 경고 해결, flutter analyze 무경고 유지\n\n추가 제안(후속)\n- 라우터의 상세 경로 패턴('/groups/:id', '/requests/:id')도 상수로 관리하기 위해 RouteConstants에 groupDetailPattern, requestDetailPattern 추가 후 app_router.dart의 path 지정부 교체\n</info added on 2025-11-07T16:17:59.041Z>",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Provider 분리",
            "description": "각 서비스 파일에서 Provider 정의를 presentation/providers/ 디렉토리로 분리",
            "details": "- lib/presentation/providers/auth_providers.dart: authServiceProvider 등\n- lib/presentation/providers/group_providers.dart: groupServiceProvider, userGroupsProvider 등\n- lib/presentation/providers/request_providers.dart: requestServiceProvider, requestListProvider 등\n- lib/presentation/providers/profile_providers.dart: profileServiceProvider 등\n- lib/presentation/providers/bank_account_providers.dart: bankAccountServiceProvider 등\n- 기존 서비스 파일에서 Provider 정의 제거하고 새 파일로 이동\n<info added on 2025-11-07T16:23:40.279Z>\nProvider 분리 및 배럴 구성 완료\n- 생성 파일 및 Provider:\n  - lib/presentation/providers/group_providers.dart: groupDetailProvider, groupMembersProvider 추가\n  - lib/presentation/providers/request_providers.dart: requestDetailProvider 추가\n  - lib/presentation/providers/providers.dart: 배럴 파일 생성 및 모든 Provider export\n\n서비스 파일에서 Provider 및 flutter_riverpod 의존 제거 완료\n- lib/common/services/auth_service.dart\n- lib/common/services/group_service.dart\n- lib/common/services/request_service.dart\n- lib/common/services/profile_service.dart\n- lib/common/services/bank_account_service.dart\n\n기존 코드 import 정리\n- Provider 사용처를 배럴 파일로 통일\n  - lib/features/auth/auth_page.dart:8 → ../../presentation/providers/providers.dart\n  - lib/features/group/group_create_page.dart:7 → ../../presentation/providers/providers.dart\n  - lib/features/requests/request_register_page.dart:8 → ../../presentation/providers/providers.dart\n  - lib/features/requests/request_list_tab.dart:11 → ../../presentation/providers/providers.dart\n  - lib/features/profile/profile_page.dart:11 → ../../presentation/providers/providers.dart\n- 서비스 클래스의 정적 메서드 직접 사용은 유지 (예: AuthService.clearAuthError)\n\n품질\n- flutter analyze 기준 린트 경고/에러 0 확인\n</info added on 2025-11-07T16:23:40.279Z>",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "에러 처리 통일",
            "description": "커스텀 Exception 클래스 및 error_handler 생성, 서비스 레이어에 적용",
            "details": "- lib/core/errors/app_exception.dart: AppException, NetworkException, AuthException 등 커스텀 Exception 클래스 정의\n- lib/core/errors/error_handler.dart: 통일된 에러 처리 로직\n- 서비스에서 Error.throwWithStackTrace 대신 커스텀 Exception 사용\n- 에러 메시지를 사용자 친화적인 메시지로 변환하는 로직 포함\n<info added on 2025-11-07T16:29:29.108Z>\n에러 처리 통일 완료 사항 반영\n\n생성 파일\n- lib/core/errors/app_exception.dart: AppException, NetworkException, AuthException, PermissionException, NotFoundException, ValidationException, ConflictException, UnknownException 정의\n- lib/core/errors/error_handler.dart: ErrorHandler(toAppException, toUserFriendlyMessage, handleAndLog) 구현. gotrue.AuthException 자동 변환, PostgrestException 코드 분기(PGRST116=NotFound, 23505=Conflict, 23503=Validation, 42501=Permission), StorageException→NetworkException 처리, 네트워크 키워드 기반 휴리스틱, kDebugMode 상세 로깅\n- lib/core/errors/errors.dart: 에러 관련 배럴 파일(export)\n\n서비스 적용(모두 errors.dart 배럴 import)\n- lib/common/services/auth_service.dart: 모든 catch에서 ErrorHandler.handleAndLog 사용, UnknownException 사용, 컨텍스트 메시지 추가(OAuth 로그인 실패(provider), 로그아웃 실패, 사용자 프로필 동기화 실패)\n- lib/common/services/group_service.dart: Error.throwWithStackTrace 제거, handleAndLog로 통일, 명시적 AppException 사용(AuthException ‘로그인이 필요합니다’, ValidationException ‘유효하지 않은 초대 코드입니다’, NotFoundException ‘그룹을 찾을 수 없습니다’), 컨텍스트 메시지 추가(그룹 생성/가입/멤버 조회/상세 조회/삭제/초대 링크 생성 실패)\n- lib/common/services/request_service.dart: 요청 목록/상세/생성/상태 변경 전체에 handleAndLog 적용, 컨텍스트 메시지 추가\n- lib/common/services/bank_account_service.dart: 조회/추가/삭제 전체에 handleAndLog 적용, 컨텍스트 메시지 추가\n- lib/common/services/profile_service.dart: 프로필 조회/이름·닉네임 업데이트에 handleAndLog 적용, 컨텍스트 메시지 추가\n\n에러 처리 기능 요약\n- Supabase 예외 자동 변환: gotrue.AuthException, PostgrestException, StorageException\n- HTTP/DB 에러코드 및 메시지 기반 분류: 인증/권한/유효성/중복/미발견/네트워크/알 수 없음\n- 사용자 친화적 메시지 변환 메서드 제공(ErrorHandler.toUserFriendlyMessage)\n- 디버그 모드 상세 로깅(kDebugMode, context/cause/stackTrace 포함)\n\n정리\n- Error.throwWithStackTrace 전면 제거, ErrorHandler.handleAndLog로 대체\n- ‘로그인이 필요합니다’→AuthException, ‘그룹을 찾을 수 없습니다’→NotFoundException, ‘유효하지 않은 초대 코드입니다’→ValidationException로 표준화\n- flutter analyze 기준 린트 경고/오류 모두 해소\n</info added on 2025-11-07T16:29:29.108Z>",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined"
          },
          {
            "id": 6,
            "title": "Repository 패턴 도입",
            "description": "domain/repositories 인터페이스 정의 및 data/repositories 구현체 생성",
            "details": "- lib/domain/repositories/ 디렉토리에 Repository 인터페이스 정의\n  - group_repository.dart\n  - request_repository.dart\n  - auth_repository.dart\n  - profile_repository.dart\n  - bank_account_repository.dart\n- lib/data/repositories/ 디렉토리에 Supabase 기반 구현체 생성\n- 기존 서비스 로직을 Repository 구현체로 이동\n- 서비스는 Repository를 통해 데이터 접근하도록 변경\n<info added on 2025-11-07T20:13:05.867Z>\nRepository 패턴 도입 완료\n\n생성된 파일\n- lib/domain/repositories/\n  - group_repository.dart: GroupRepository 인터페이스 정의\n  - request_repository.dart: RequestRepository 인터페이스 정의\n  - auth_repository.dart: AuthRepository 인터페이스 정의\n  - profile_repository.dart: ProfileRepository 인터페이스 정의\n  - bank_account_repository.dart: BankAccountRepository 인터페이스 정의\n  - repositories.dart: 배럴 파일(export)\n- lib/data/repositories/\n  - group_repository_impl.dart: GroupRepositoryImpl(기존 GroupService 로직 이관)\n  - request_repository_impl.dart: RequestRepositoryImpl(기존 RequestService 로직 이관)\n  - auth_repository_impl.dart: AuthRepositoryImpl(기존 AuthService 로직 이관)\n  - profile_repository_impl.dart: ProfileRepositoryImpl(기존 ProfileService 로직 이관)\n  - bank_account_repository_impl.dart: BankAccountRepositoryImpl(기존 BankAccountService 로직 이관)\n  - repositories.dart: 배럴 파일(export)\n\n서비스 리팩토링\n- 모든 서비스가 Repository 의존성 주입(생성자) 방식으로 변경\n- 하위 호환을 위해 fromClient(SupabaseClient client) 팩토리 추가\n  - fromClient 내부에서 대응하는 RepositoryImpl로 감싸서 생성\n- 서비스의 공개 메서드는 내부적으로 Repository 메서드로 위임\n\nProvider 업데이트\n- 기존 Provider 명/시그니처 유지\n- Provider 생성 시 Service.fromClient(Supabase.instance.client) 사용으로 통일\n- 파일 레퍼런스(서비스별 Provider 포함): \n  - lib/common/services/auth_service.dart\n  - lib/common/services/group_service.dart\n  - lib/common/services/request_service.dart\n  - lib/common/services/profile_service.dart\n  - lib/common/services/bank_account_service.dart\n\n배럴/임포트 규칙\n- lib/domain/repositories/repositories.dart 에서 모든 인터페이스 export\n- lib/data/repositories/repositories.dart 에서 모든 구현체 export\n- 서비스/Provider 내 임포트 예시:\n  - import 'package:…/domain/repositories/repositories.dart';\n  - import 'package:…/data/repositories/repositories.dart';\n\n품질/검증\n- flutter analyze 무경고 상태 확인\n- 순환 의존성 없음(서비스→도메인 인터페이스, 구현은 data 레이어에만 위치)\n- 기존 API/Provider 외부 계약은 변경 없음(내부 구현만 Repository로 대체)\n\n마이그레이션 노트\n- 서비스 파일에서 직접 SupabaseClient 접근 코드 제거\n- 예: client.from('groups')… 호출부 → GroupRepository로 위임\n- 페이지/위젯 레벨 로직 변경 불필요(서비스 API 유지)\n\n후속 작업 연결\n- UseCase 레이어에서 도메인 Repository 인터페이스를 직접 의존하도록 설계 예정(11.7 연계)\n</info added on 2025-11-07T20:13:05.867Z>",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined"
          },
          {
            "id": 7,
            "title": "UseCase 도입",
            "description": "domain/usecases 디렉토리에 비즈니스 로직 UseCase 클래스 생성",
            "details": "- lib/domain/usecases/ 디렉토리 생성\n- 비즈니스 로직을 UseCase 클래스로 캡슐화\n- 예: CreateGroupUseCase, JoinGroupUseCase, CreateRequestUseCase, UpdateRequestStatusUseCase 등\n- UseCase는 Repository를 의존성으로 받아 사용\n- 프레젠테이션 레이어는 UseCase를 통해 비즈니스 로직 호출",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined",
            "updatedAt": "2025-11-07T20:56:25.933Z"
          },
          {
            "id": 8,
            "title": "main.dart 리팩토링",
            "description": "딥링크 처리, 인증 콜백, 초대 코드 처리를 별도 핸들러로 분리",
            "details": "- lib/core/deep_link/deep_link_handler.dart: 딥링크 처리 로직 분리\n- lib/core/auth/auth_callback_handler.dart: 인증 콜백 처리 로직 분리\n- lib/core/invite/invite_handler.dart: 초대 코드 처리 로직 분리\n- main.dart는 앱 초기화와 라우팅만 담당하도록 경량화\n- 기존 700+ 라인의 로직을 각 핸들러로 분산",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined",
            "updatedAt": "2025-11-07T20:56:25.939Z"
          },
          {
            "id": 9,
            "title": "기존 코드 마이그레이션",
            "description": "모든 기존 코드를 새 구조와 공통 컴포넌트를 사용하도록 업데이트",
            "details": "- lib/features/group/group_page.dart: 공통 컴포넌트(ErrorView, InfoRow 등) 사용\n- lib/features/home/groups_tab.dart: 공통 컴포넌트 사용\n- lib/features/group/group_create_page.dart: 상수 사용\n- lib/common/services/*.dart: Repository 패턴 적용\n- 모든 위젯에서 중복 코드 제거 및 공통 컴포넌트/유틸리티 사용\n- import 경로 업데이트",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11,
            "parentId": "undefined",
            "updatedAt": "2025-11-07T20:56:25.942Z"
          }
        ],
        "updatedAt": "2025-11-07T20:56:25.942Z"
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2025-11-07T20:56:25.942Z",
      "taskCount": 11,
      "completedCount": 3,
      "tags": [
        "master"
      ],
      "created": "2025-11-07T21:42:39.695Z",
      "description": "Tasks for master context",
      "updated": "2025-11-08T04:44:02.825Z"
    }
  }
}
