{
  "master": {
    "tasks": [
      {
        "id": "1",
        "title": "프로젝트 초기 세팅 및 네비게이션 스캐폴딩",
        "description": "Flutter 3.24.3/Dart 3.5.2 기준 앱 부팅/환경 분리/Supabase 초기화/기본 페이지와 하단 탭(IndexedStack) 구조를 스캐폴딩합니다.",
        "details": "- pubspec.yaml 의존성(예시): supabase_flutter:^2, flutter_dotenv, intl, uni_links, share_plus, freezed, json_serializable, build_runner.\n- .env(.gitignore): SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_REDIRECT_URI.\n- iOS/Android URL Scheme: splitbills://invite.\n- main.dart 의사코드:\n  void main() async {\n    WidgetsFlutterBinding.ensureInitialized();\n    await dotenv.load(fileName: \".env\");\n    await Supabase.initialize(\n      url: dotenv.env['SUPABASE_URL']!,\n      anonKey: dotenv.env['SUPABASE_ANON_KEY']!,\n    );\n    runApp(const App());\n  }\n  class App extends StatelessWidget { ... MaterialApp(home: SplashPage()) }\n- 하단 탭: Groups/Requests/Profile, IndexedStack으로 상태 유지.\n- SplashPage→AuthPage/HomePage 라우팅 뼈대만 먼저 구성.",
        "testStrategy": "- flutter analyze 통과.\n- DEV/PROD 환경에서 Supabase.initialize 성공/실패 분기 테스트.\n- IndexedStack 탭 전환 시 스크롤/상태 유지 수동 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "in-progress",
        "subtasks": [
          {
            "id": 1,
            "title": "Android/iOS URL 스킴을 splitbills://invite로 통일하고 딥링크 라우팅 갱신",
            "description": "현재 tricount 스킴을 요구사항 splitbills://invite로 변경하고 모든 플랫폼/라우팅 설정을 정리합니다.",
            "dependencies": [],
            "details": "AndroidManifest.xml 인텐트 필터를 splitbills://invite 로 교체하고 기존 tricount 필터 제거; iOS Info.plist URL Types에 splitbills 추가 및 기존 항목 정리; 앱 내 딥링크 파서에서 /invite 경로와 code 파라미터 파싱으로 통일; 라우터 매핑(Splash→Auth/Home 포함)에서 초대 진입 흐름 검증 및 잘못된 스킴 가드 추가.",
            "status": "done",
            "testStrategy": "Android: adb VIEW 인텐트로 splitbills://invite?code=ABC 테스트, 콜드/웜 스타트 모두 확인. iOS: Xcode URL Schemes로 동일 시나리오 검증. 잘못된 스킴/누락 파라미터 방어 동작 확인.",
            "parentId": "undefined",
            "updatedAt": "2025-11-05T15:45:25.714Z"
          },
          {
            "id": 2,
            "title": ".env 기반 환경 주입 확정 및 빌드 스크립트/CI 정리",
            "description": "flutter_dotenv 중심으로 환경 주입을 표준화하고 dev/prod 분리를 적용합니다.",
            "dependencies": [],
            "details": "pubspec에 flutter_dotenv 추가 및 .env/.env.dev/.env.prod 구성(.gitignore 포함); lib/config/environment.dart 래퍼 작성해 SUPABASE_URL/ANON_KEY/REDIRECT_URI 안전 로드; main.dart에서 dotenv.load→Supabase.initialize 적용; 로컬/CI에서 .env 주입 방식 문서화 및 GitHub Actions에서 Secrets로 .env 생성 단계 반영.",
            "status": "done",
            "testStrategy": "로컬에서 .env 정상/누락/오염 값 각각 실행해 초기화 성공/실패 분기 확인. flutter run, flutter build 환경별로 값이 반영되는지 로그로 검증.",
            "parentId": "undefined",
            "updatedAt": "2025-11-05T15:45:46.589Z"
          },
          {
            "id": 3,
            "title": "IndexedStack 탭 상태 유지 점검 및 Nested Navigator 도입 결정",
            "description": "하단 탭 전환 시 상태 유지와 올바른 뒤로가기 동작을 보장하고 필요 시 탭별 Navigator를 도입합니다.",
            "dependencies": [
              1,
              2
            ],
            "details": "현 Home/탭 구현을 점검해 IndexedStack이 스크롤/폼 상태를 유지하는지 확인; 부족 시 각 탭에 GlobalKey<NavigatorState> 기반 Nested Navigator + Offstage 구조로 리팩터링; PageStorageKey 적용, 안드로이드 뒤로가기 시 탭 내부 스택 우선 팝 처리; 딥링크로 특정 탭 진입 후 복귀 흐름 정합성 확보.",
            "status": "pending",
            "testStrategy": "수동 시나리오: 각 탭에서 상세로 진입→탭 전환→복귀 시 스크롤/폼 값 유지 확인. 딥링크로 Requests 탭 진입 후 뒤로가기 동작 검증. 위젯 테스트로 탭 전환 후 상태 보존 여부 체크.",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "flutter analyze 통과 및 부팅 실패/예외 핸들링 보강",
            "description": "정적 분석 경고를 정리하고 부팅 단계의 예외를 사용자 친화적으로 처리합니다.",
            "dependencies": [
              1,
              2,
              3
            ],
            "details": "main()에 runZonedGuarded와 FlutterError.onError 설정으로 로깅 일원화; dotenv.load와 Supabase.initialize try/catch 래핑 및 ErrorPage/Retry 제공; 딥링크 파싱 실패 시 토스트/스낵바와 안전한 홈 복귀 처리; flutter analyze/format 실행해 경고 제거 및 CI에 분석 스텝 추가.",
            "status": "pending",
            "testStrategy": "flutter analyze가 0 exit를 반환하는지 확인. .env 누락/잘못된 키/네트워크 실패 등을 모킹해 ErrorPage 노출과 재시도 동작을 수동 검증. 딥링크 파싱 예외 시 앱이 크래시하지 않는지 확인.",
            "parentId": "undefined"
          }
        ],
        "complexity": 4,
        "recommendedSubtasks": 4,
        "expansionPrompt": "레포의 현재 구현을 기준으로 다음을 정렬하세요: 1) URL 스킴 통일(요구사항 splitbills://invite vs 현재 tricount://group/join) 및 플랫폼 설정 갱신, 2) 환경 주입 전략 확정(.env/flutter_dotenv vs 현재 --dart-define)과 빌드 스크립트, 3) IndexedStack+탭 유지 구조 검증 및 Nested Navigator 필요 시 도입, 4) flutter analyze 및 기본 부팅 실패/예외 핸들링 보강.",
        "updatedAt": "2025-11-05T15:45:46.589Z"
      },
      {
        "id": "2",
        "title": "OAuth 인증 플로우(Supabase Auth) 구현",
        "description": "Google/Apple/Kakao OAuth를 Supabase Auth로 연동하고 Splash→Auth/Home 라우팅을 완성합니다.",
        "details": "- SplashPage: 최상단에서 supabase.auth.currentSession 확인, onAuthStateChange 구독→세션 생성/만료 라우팅.\n- AuthPage: 튜토리얼 카드 + 버튼 3종.\n- 로그인 의사코드:\n  final resp = await supabase.auth.signInWithOAuth(\n    Provider.google,\n    redirectTo: dotenv.env['SUPABASE_REDIRECT_URI'],\n  );\n  if (resp.session != null) context.go('/home');\n- Apple은 iOS 전용 가드; Kakao는 Supabase Custom Provider 설정(redirect URI만) 사용.\n- 최초 로그인 시 users 테이블에 최소 정보 upsert(없으면 insert).",
        "testStrategy": "- 세션 null/존재 라우팅 단위/위젯 테스트.\n- OAuth 실패/취소/재시도 UX 확인(모킹).\n- users upsert 호출 파라미터/예외 로깅 검증.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 4,
        "recommendedSubtasks": 4,
        "expansionPrompt": "1) 기존 PKCE 콜백 처리(main.dart _handleAuthCallback)와 라우팅 재확인, 2) Kakao/Apple/Google 각각 redirect URI/스킴 일치 점검 및 오류 UX 스낵바 표준화, 3) users upsert 후 오류 로깅/리커버리 정리, 4) 세션 만료/로그아웃 후 재로그인 경계 케이스 보강(재시도 딜레이/flow state)."
      },
      {
        "id": "3",
        "title": "데이터 모델 및 리포지토리 레이어 구축",
        "description": "PRD 스키마(users, groups, members, expenses, settlements, exchange_rates)를 기준으로 DTO와 Supabase CRUD 리포지토리를 작성합니다.",
        "details": "- freezed/json_serializable로 모델 정의(테이블 필드명 준수: groups.base_currency 포함).\n- 예시 모델:\n  @freezed class Group with _$Group { factory Group({required String id, required String name, required String inviteCode, required String baseCurrency}) = _Group; factory Group.fromJson(Map<String,dynamic> json)=>_$GroupFromJson(json); }\n- 리포지토리 예시:\n  class GroupRepository { final SupabaseClient client; Future<List<Group>> byUser(String uid) async => (await client.from('groups').select().then(...)).map(Group.fromJson).toList(); Future<Group> create(String name,String cur) async => client.from('groups').insert({'name':name,'base_currency':cur}).select().single().then(Group.fromJson); }\n- 에러를 AppException으로 래핑해 호출부 단순화.",
        "testStrategy": "- JSON 직렬화/역직렬화 라운드트립 테스트.\n- CRUD 메서드 시그니처/에러 분기 단위 테스트(HTTP/Supa 모킹).",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 7,
        "recommendedSubtasks": 7,
        "expansionPrompt": "1) freezed/json_serializable 및 build_runner 파이프라인 추가, 2) DTO 정의(users, groups(base_currency), members, expenses(participants[]), settlements, exchange_rates), 3) Map 기반 서비스(Group/Request)→타입 안전 리포지토리로 마이그레이션, 4) 공통 AppException/Result 도입, 5) 직렬화 라운드트립/널세이프티 테스트, 6) 생성 코드 스크립트/ignore 정리, 7) 단계적 치환(컴파일 안전 보장)."
      },
      {
        "id": "4",
        "title": "그룹 생성/목록/상세(UI) 구현",
        "description": "그룹 생성(name, base_currency)과 목록/상세(GroupPage) UI, 기본 상태관리 및 새로고침을 구현합니다.",
        "details": "- 그룹 생성 다이얼로그→GroupRepository.create 호출→성공 시 리스트 갱신.\n- GroupPage: 상단 잔액/지출 섹션, 날짜/사용자별 필터 탭(간단 리스트 구현).\n- 초대 코드(invite_code)는 DB 트리거/함수 생성 가정: insert 결과에 포함.\n- 통화 포맷: intl NumberFormat.currency(locale/currency 코드 활용).",
        "testStrategy": "- 생성 폼 검증(이름/통화 필수) 위젯 테스트.\n- 생성 후 목록 반영/스낵바 확인.\n- 빈 상태/에러 상태 화면 처리 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 5,
        "recommendedSubtasks": 5,
        "expansionPrompt": "1) GroupPage 스켈레톤(지출/잔액 섹션, 필터 탭) 신규, 2) GroupCreatePage 완료 후 목록 갱신/스낵바 흐름 정제, 3) 상태관리(현재 로컬 setState→Provider/캐시) 정리, 4) 빈/에러/로딩 상태 UX 보강, 5) 통화 표기(intl) 유틸 도입 및 적용."
      },
      {
        "id": "5",
        "title": "딥링크 초대 처리 및 자동 가입",
        "description": "초대 링크(splitbills://invite?code=XXXX) 공유/열기 처리와 자동 가입(RPC)을 구현합니다.",
        "details": "- 링크 생성: 초대 공유 시 `splitbills://invite?code=$inviteCode`를 share_plus로 공유.\n- 수신: uni_links로 getInitialLink()/linkStream 처리, Uri.parse로 code 추출.\n- 가입 의사코드:\n  final code = uri.queryParameters['code'];\n  await supabase.rpc('rpc_create_invite', params: {'code': code});\n  // 또는 members insert: from('members').insert({'user_id': uid,'group_id': gid})\n- cold/warm start 모두 처리, 실패 시 안내/재시도 제공.",
        "testStrategy": "- 링크 파싱 유닛 테스트(유효/무효/누락 코드).\n- 앱 실행 중/비실행 상태 모두 링크 처리 수동 검증.\n- RPC 실패/중복 가입 예외 처리 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 3,
        "recommendedSubtasks": 3,
        "expansionPrompt": "1) 초대 링크 포맷 통일(요구 splitbills://invite?code= vs 현재 tricount://group/join?code=) 및 공유 훅 추가(share_plus), 2) app_links 기반 초기/런타임 링크 파싱 재검증, 3) 가입 실패/중복 UX와 리다이렉트 정책 정리."
      },
      {
        "id": "6",
        "title": "지출 등록/수정(분담비 포함) 구현",
        "description": "ExpensePage에서 날짜, 금액, 통화, 부담자, 참가자, 분담 비율 입력 및 저장(update 포함)을 구현합니다.",
        "details": "- Equal split 토글→참가자 수로 균등 분배, 커스텀 모드에서 비율 합=1.0 검증.\n- 환율 표시는 그룹 base_currency 기준으로 환산 표시(표시는 rates 사용). DB 저장은 원화/선택 통화와 participants 배열.\n- 의사코드:\n  final total = amount; final ratios = {uid1:0.5, uid2:0.5}; assert((ratios.values.reduce((a,b)=>a+b) - 1.0).abs() < 1e-6);\n  await client.from('expenses').insert({ 'group_id': gid, 'payer_id': uidPayer, 'amount': amount, 'currency': cur, 'description': desc, 'date': date.toIso8601String(), 'participants': ratios.entries.map((e)=>{'user_id':e.key,'ratio':e.value}).toList(), });",
        "testStrategy": "- 폼 검증(금액>0, 참가자≥2, 비율합=1) 위젯/단위 테스트.\n- 저장 성공 후 GroupPage 목록 즉시 갱신 확인.\n- 환율 누락 시 표시 폴백 동작 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 8,
        "recommendedSubtasks": 10,
        "expansionPrompt": "1) ExpensePage 폼(날짜/금액/통화/부담자/참가자/메모), 2) Equal split/커스텀 비율 편집기와 합=1.0 검증, 3) participants 배열 직렬화/역직렬화, 4) 환율 표시 유틸(그룹 base_currency 기준 환산) 및 폴백, 5) insert/update API와 optimistic 갱신, 6) 그룹 상세 리스트 반영/캐시 무효화, 7) 부동소수점/반올림 규칙, 8) 접근성/키보드 UX, 9) 단위/위젯 테스트, 10) 오류/권한 가드."
      },
      {
        "id": "7",
        "title": "정산 계산(Supabase Function) 연동",
        "description": "최소 송금 계산을 RPC로 호출해 미리보기/확정 저장을 구현합니다.",
        "details": "- RPC 계약: rpc_calculate_minimum_transfers(group_id) → [{from_user,to_user,amount}] 반환 가정.\n- UI: GroupPage ‘정산 계산’ 버튼→미리보기 다이얼로그→확정 시 settlements insert.\n- 의사코드:\n  final rows = await client.rpc('rpc_calculate_minimum_transfers', params:{'group_id': gid});\n  setState(()=>preview = rows);\n  // Confirm\n  await client.from('settlements').insert(rows.map((r)=>{...}).toList());",
        "testStrategy": "- 빈 결과/에러 처리.\n- 금액 반올림 표기 검증.\n- 동일 관계 상쇄(양방향 발생 시) 미리보기 검증(목업).",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 6,
        "recommendedSubtasks": 6,
        "expansionPrompt": "1) RPC 클라이언트 래퍼와 타입 매핑, 2) GroupPage ‘정산 계산’ 버튼/미리보기 다이얼로그, 3) 반올림/표시 규칙, 4) 확정 시 settlements insert 트랜잭션 처리, 5) 빈/에러/양방향 상쇄 처리, 6) 모킹 기반 단위 테스트."
      },
      {
        "id": "8",
        "title": "정산 상태 실시간 추적 및 요청 화면군",
        "description": "Supabase Realtime 구독으로 settlements 상태를 실시간 반영하고 RequestRegister/List/Detail 화면에서 상태 전이를 제공합니다.",
        "details": "- settlements 테이블에 status(pending/paid/rejected/rolled_back) 가정.\n- Realtime 구독 의사코드:\n  final ch = supabase.channel('public:settlements').on(PostgresChangeEvent.update, ChannelFilter(table:'settlements',schema:'public',filter:'group_id=eq.$gid'), (payload){ setState(()=>applyChange(payload)); }).subscribe();\n- RequestRegisterPage: 계산 결과로 pending 생성.\n- RequestListPage: 상태 필터 탭.\n- RequestPage: paid/rejected/rolled_back 업데이트와 롤백 처리.",
        "testStrategy": "- 상태 전이 단위 테스트(pending→paid/rejected→rolled_back).\n- 구독 해제/재구독 시 메모리 누수 없음을 확인.\n- 오프라인 후 재연결 시 동기화 확인(재조회 트리거).",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 6,
        "recommendedSubtasks": 7,
        "expansionPrompt": "1) Supabase Realtime 구독 채널 구성/해제, 2) RequestListTab/RequestPage에 실시간 반영(캐시 병합), 3) 상태 전이(pending→paid|rejected|rolled_back) 맵핑과 현재 enum(completed/declined) 정렬, 4) 오프라인 재연결 시 재조회, 5) 메모리 누수/수명주기 가드, 6) 에러 리트라이/토스트, 7) 위젯 테스트(상태 전이)."
      },
      {
        "id": "9",
        "title": "송금 액션(플레이스홀더) 및 계좌 복사",
        "description": "실제 결제 연동 전까지 계좌 복사/외부 앱 열기 동작과 향후 결제 API 인터페이스를 준비합니다.",
        "details": "- PaymentProvider 인터페이스 정의: pay(Settlement s) → Future<PaymentResult>.\n- Kakao/Toss 스텁 구현(미사용, 훅만 노출).\n- RequestPage ‘송금하기’: Clipboard.setData(bankAccount) + launchUrl(카카오/토스 스킴) 시도.\n- 실패 시 안내 및 수동 paid 처리 버튼 유지.",
        "testStrategy": "- URL 스킴 실패 예외 처리 경로 확인.\n- 클립보드 복사 토스트 표시 테스트.\n- Provider 스텁 모킹 컴파일 안정성 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 4,
        "recommendedSubtasks": 4,
        "expansionPrompt": "1) PaymentProvider 인터페이스/결과 타입 정의, 2) 카카오/토스 URL 스킴 런처 스텁, 3) RequestPage에 ‘송금하기’ 액션 추가(Clipboard+launchUrl), 4) 실패 시 안내 및 수동 완료 처리 버튼 유지/가드."
      },
      {
        "id": "10",
        "title": "프로필/계좌 관리(User Metadata) 및 포맷팅",
        "description": "ProfilePage에서 실명/닉네임/계좌 정보를 Supabase Auth user_metadata로 저장/로드하고 통화/날짜 포맷 일관성을 적용합니다.",
        "details": "- Supabase Auth 업데이트:\n  await supabase.auth.updateUser(UserAttributes(data:{'real_name':name,'nickname':nick,'bank_account':account}));\n- 표시 시 일부 마스킹 처리.\n- 통화/날짜 포맷: intl NumberFormat.currency, DateFormat.yMMMd 지역화 반영.\n- RequestPage에서 수신자 계좌 표시 연동.",
        "testStrategy": "- 저장 후 재진입 값 복원 테스트.\n- 누락/부분 입력 시 검증 메시지 확인.\n- RequestPage에 계좌 표시 및 마스킹 렌더링 확인.",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": [],
        "complexity": 5,
        "recommendedSubtasks": 6,
        "expansionPrompt": "1) Supabase Auth user_metadata 로드/저장 유틸 추가, 2) 기존 users 테이블 업데이트와 메타데이터 병행/이행 전략, 3) 계좌 표시 마스킹/복사 UX 정리, 4) intl 통화/날짜 포맷 유틸 공통화, 5) RequestPage 수신자 계좌 표시 연동, 6) 저장 후 재진입 복원/유효성 검증 테스트."
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2025-11-05T15:45:46.591Z",
      "taskCount": 10,
      "completedCount": 0,
      "tags": [
        "master"
      ]
    }
  }
}