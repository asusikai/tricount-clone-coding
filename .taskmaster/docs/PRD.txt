<context>
# 개요 (Overview)
splitBills는 사용자가 그룹 단위로 지출을 기록하고, 최소 송금 방식으로 정산할 수 있는 모바일 애플리케이션이다.
핵심 목표는 "누가 얼마를 냈는지"를 직관적으로 관리하고, 실시간 환율 기반으로 정확히 계산된 송금 절차를 자동화하는 것이다.

이 앱은 여행, 공동 구매, 생활비 정산 등 여러 명이 함께 지출하는 모든 상황에서 사용 가능하며,
사용자는 복잡한 엑셀 계산이나 메신저 송금 정리 없이 자동화된 정산 결과를 확인할 수 있다.

핵심 가치:
- 다중 통화 기반의 정확한 정산
- 간편한 로그인 및 그룹 초대
- 자동 송금 및 실시간 정산 상태 추적

------------------------------------------------------------

# 핵심 기능 (Core Features)
기능: OAuth 로그인
설명: Google, Apple, Kakao 계정으로 간편 인증
중요성: 높음
작동 개요: Supabase Auth + OAuth Provider 연동

기능: 그룹 관리
설명: 그룹명 및 기본 통화 설정, 초대 코드 자동 생성
중요성: 높음
작동 개요: Supabase groups 테이블 기반 CRUD

기능: 초대 기능
설명: 초대 링크 클릭 시 앱 실행 및 자동 가입
중요성: 높음
작동 개요: Deep Link + Supabase RPC rpc_create_invite

기능: 지출 등록
설명: 날짜, 금액, 통화, 부담자, 분담 비율 입력
중요성: 높음
작동 개요: expenses 테이블 insert/update

기능: 정산 계산
설명: 최소 송금 방식 자동 계산
중요성: 높음
작동 개요: Supabase Function (SQL) 기반 알고리즘

기능: 송금 처리
설명: 카카오페이/토스페이 API 연동 (차후)
중요성: 중간
작동 개요: 결제 모듈 REST API 연동

기능: 정산 상태 추적
설명: 실시간 송금/수락/거절 상태 표시
중요성: 높음
작동 개요: Supabase Realtime Sync 활용

------------------------------------------------------------

# 사용자 경험 (User Experience)

주요 사용자 페르소나
1. 여행 그룹 리더: 여러 명의 지출을 관리하며 자동 정산을 원하는 사용자
2. 모임 구성원: 별도 계산 없이 본인 송금 내역만 확인하고 싶어하는 사용자
3. 가계부형 사용자: 개인별 사용 패턴 기록 및 지출 분석에 관심이 있는 사용자

핵심 사용자 흐름
1. 로그인 → 그룹 생성 → 초대 링크 공유
2. 그룹원 참여 → 지출 등록 → 정산 계산
3. 송금 요청 → 수락/거절 → 정산 완료

UI/UX 고려사항
- Flutter NavigationBar 기반 하단 탭 구조
- IndexedStack으로 탭 상태 유지
- 그룹별 색상 테마 및 다국어 통화 포맷 지원
</context>

<PRD>
# 기술 아키텍처 (Technical Architecture)

1. 시스템 구성
Frontend: Flutter (Android / iOS)
Backend: Supabase (PostgreSQL, Auth, Storage, Realtime)
API: Supabase Functions (SQL RPC), KakaoPay/TossPay 연동 예정
CI/CD: GitHub Actions → TestFlight / Google Play Internal Test
Auth: Google / Apple / Kakao OAuth

2. 데이터 모델
users(id, email, name, provider)
groups(id, name, invite_code, base_currency)
members(id, user_id, group_id, joined_at)
expenses(id, group_id, payer_id, amount, description, participants[])
settlements(id, group_id, from_user, to_user, amount)
exchange_rates(currency, rate, updated_at)

3. 연동 구조
- Supabase Realtime → 정산 상태 자동 업데이트
- DeepLink → 초대 및 로그인 콜백 처리
- REST API → 결제 연동 (차후)

------------------------------------------------------------

# 개발 로드맵 (Development Roadmap)

1단계 - MVP
- Google/Apple/Kakao OAuth 로그인
- 그룹 생성 및 초대 링크 공유
- 지출 등록 및 분담 계산
- 최소 송금 로직 (Supabase Function)
- Flutter UI (HomePage, GroupPage, ExpensePage)

2단계 - 고도화
- 송금 API 연동 (KakaoPay, TossPay)
- 정산 상태 실시간 업데이트
- 사용자 프로필 및 계좌 관리 페이지
- 다국어 및 다통화 지원 (KRW, USD, EUR)

3단계 - 확장
- FCM Push 알림
- 지출 통계 대시보드
- 클라우드 백업 및 데이터 내보내기

------------------------------------------------------------

# 논리적 의존 체계 (Logical Dependency Chain)

1. Auth → Group → Expense → Settlement 순서로 개발
2. MVP 목표: 로그인 → 그룹 생성 → 지출 등록 → 정산 계산 → 결과 확인
3. 각 기능은 독립적으로 테스트 가능해야 함
4. UI를 먼저 완성한 후 Supabase 연동 진행

------------------------------------------------------------

# 리스크 및 대응 전략 (Risks and Mitigations)

리스크: Supabase Realtime 지연
영향: 정산 상태 불일치
대응: 상태 캐싱 및 재동기화 로직 추가

리스크: 결제 API 불안정
영향: 송금 실패
대응: 수동 송금 및 상태 수동 업데이트 기능 제공

리스크: Deep Link 인증 실패
영향: 초대 실패
대응: 예외 처리 및 fallback URI 구성

리스크: 환율 API 비가용
영향: 금액 불일치
대응: 캐시된 환율 데이터 사용

------------------------------------------------------------

# 부록 (Appendix)
리서치 참고:
- Tricount, Splitwise 정산 로직 비교
- Supabase Function 기반 송금 최소화 알고리즘 실험

기술 사양:
- Flutter SDK: 3.24.3
- Dart: 3.5.2
- Supabase SDK: 2.x
- 빌드 환경: Android Studio / Xcode / GitHub Actions
</PRD>
